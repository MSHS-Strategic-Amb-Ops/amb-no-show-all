---
output: 
  html_document:
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
    fig_width: 7
    fig_height: 6
---


<style type="text/css">
div.main-container {
  max-width: 2000px;
  margin-left: 0;
  margin-right: auto;
}
</style>

<style>
.tocify {
color: black;
}
<!-- } -->
<!-- .tocify .tocify-header { -->
<!--     position: fixed; -->
<!--     <!-- top: 50px; --> -->
<!--     left: 50px; -->
<!--     width: 350px; -->
<!--     <!-- border: solid 3px black; --> -->
<!--     <!-- height: 200px; --> -->
<!--  border: none; -->
<!-- } -->
.tocify .tocify-header .active {
color: white;
background: #d80b8c;
font-weight: bold;
}
<!-- .tocify .tocify-item { -->
<!-- background: white; -->
<!-- color: black; -->
<!--  border: none; -->
<!-- } -->
</style>


<style>
  .nav-pills>li>a:hover, .nav-pills>li>a:focus, .nav-pills>li.active>a,     .nav-pills>li.active>a:hover, .nav-pills>li.active>a:focus{
     background-color: #210070;
     }
</style>

<style>
.container { width: 1800px; }
h2 {
  background-color: #dddedd;
  color: black;
  text-indent: 20px;
  <!-- font-weight: bold; -->
}
h3 {
  background-color: #f2f2f2;
  color: black;
  text-indent: 20px;
  <!-- font-weight: bold; -->
}
h4 {
  <!-- background-color: #dddedd; -->
  <!-- color: black; -->
  text-indent: 50px;
  <!-- font-weight: bold; -->
}
</style>

<style>
.blackbox {
  padding: 1em;
  background: white;
  color: black;
  border: 2px solid #7f7f7f;
  width: 100%;
  position: center;
  align: center;
  margin: 0px auto;
}
.center {
  text-align: left;
  margin: 0px auto;
}
</style>


<!-- ```{css toc-content, echo = FALSE} -->
<!-- #TOC { -->
<!--   right: 270px; -->
<!--   margin: 20px 0px 25px 0px; -->
<!-- } -->

<!-- .main-container { -->
<!--     margin-left: 200px; -->
<!-- } -->
<!-- ``` -->


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```


```{r Load Packages, echo = FALSE, warning = FALSE, message = FALSE}

# # Load packages -----------------------------------------------------------------------------------
suppressMessages({
  memory.limit(size = 8000000)
  library(readxl)
  library(writexl)
  library(plyr)
  library(dplyr)
  library(data.table)
  library(zoo)
  library(shiny)
  library(shinydashboard)
  library(shinydashboardPlus)
  library(shinyWidgets)
  library(htmlwidgets)
  library(lubridate)
  library(tcltk)
  library(tidyverse)
  library(plotly)
  library(knitr)
  library(kableExtra)
  library(leaflet)
  library(grid)
  library(gridExtra)
  library(eeptools)
  library(ggQC)
  library(zipcodeR)
  library(utils)
  library(scales)
  library(chron)
  library(bupaR)
  library(shiny)
  library(DT)
  library(DiagrammeR)
  library(shinyalert)
  library(edeaR)
  library(processmapR)
  library(processmonitR)
  library(processanimateR)
  library(tidyr)
  library(lubridate)
  library(RColorBrewer)
  library(DiagrammeR)
  library(ggplot2)
  library(leaflet)
  library(readr)
  library(highcharter)
  library(ggforce) # for 'geom_arc_bar'
  library(packcircles) # for packed circle graph
  library(viridis)
  library(ggiraph)
  library(treemapify)
  library(treemap)
  library(broom)
  library(extrafont)
  library(tis) # for US holidays
  library(vroom)
  library(sjmisc)
  library(tools)
  library(here)
  library(shinyBS)
  library(shinyscreenshot)
  library(fasttime)
  library(shinycssloaders)
  library(feather)
  # library(zipcodeR)
  library(formattable)
  library(shinyjs)
  library(janitor)
  library(patchwork)
  library(flexdashboard)
  # library(tidyverse)
  # library(viridis)
  # library(hrbrthemes)
  # library(plotly)
  # install.packages("bsts")
  library(bsts)
  library(reactable)
  # install.packages("reactablefmtr")
  library(reactablefmtr)
  library(svDialogs)
  # library(openxlsx)
  library(flextable)
  library(officedown)
  library(officer)
  library(magrittr)
  library(webshot) 
  library(png)
  library(ggh4x)
  library(RODBC)
  library(DBI)
  library(odbc)
  library(dbplyr)
  library(pool)
  library(emojifont)
})

# devtools::install_github("hafen/lazyrmd")
# require(lazyrmd)
# 
# options(repos = c(tessera = "http://packages.tessera.io",
#   getOption("repos")))
# install.packages("lazyrmd")
# require(lazyrmd)

```


```{r Graph asthetics, echo = FALSE, warning = FALSE, message = FALSE}
### Color Functions for Graphs ============================================================

# Mount Sinai corporate colors "USE THIS TO ADD COLORS"
MountSinai_colors <- c(
  `dark purple`  = "#212070",
  `dark pink`    = "#d80b8c",
  `dark blue`    = "#00aeef",
  `dark grey`    = "#7f7f7f",
  `yellow`       = "#ffc000",
  `purple`       = "#7030a0",
  `med purple`   = "#5753d0",
  `med pink`     = "#f75dbe",
  `med blue`     = "#5cd3ff",
  `med grey`     = "#a5a7a5",
  `light purple` = "#c7c6ef",
  `light pink`   = "#fcc9e9",
  `light blue`   = "#c9f0ff",
  `light grey`   = "#dddedd"
  )

# Function to extract Mount Sinai colors as hex codes
# Use Character names of MountSinai_colors

MountSinai_cols <- function(...) {
  cols <- c(...)
  
  if (is.null(cols))
    return (MountSinai_colors)
  
  MountSinai_colors[cols]
}

# Color Function that can be used to call all colors is "MountSinai_cols()"
# Use in ggplot 

  #MountSinai_cols()       # will provide all colors and their hex codes in a table 
  #MountSinai_cols("pink") # will provide color name and the hex code for the pink color

# Create palettes 
MountSinai_palettes <- list(
  `all`   = MountSinai_cols("dark purple","dark pink","dark blue","dark grey",
                            "med purple","med pink","med blue","med grey", 
                            "light purple","light pink","light blue","light grey"),
  
  `main`  = MountSinai_cols("dark purple","dark pink","dark blue","dark grey"),
  
  `purple`  = MountSinai_cols("dark purple","med purple","light purple"),
  
  `pink`  = MountSinai_cols("dark pink","med pink","light pink"),
  
  `blue`  = MountSinai_cols("dark blue", "med blue", "light blue"),
  
  `grey`  = MountSinai_cols("dark grey", "med grey", "light grey"),
  
  `purpleGrey` = MountSinai_cols("dark purple", "dark grey"),
  
  `pinkBlue` = MountSinai_cols("dark pink", "dark blue")
  
)

# MountSinai_palettes
# Return function to interpolate a Mount Sinai color palette
# default value is the main palette, reverse = True will change the order

MountSinai_pal <- function(palette = "all", reverse = FALSE, ...) {
  pal <- MountSinai_palettes[[palette]]
  
  if (reverse) pal <- rev(pal)
  
  colorRampPalette(pal, ...)
}



# Scale Function for ggplot can be used instead of scale_color_manual
scale_color_MountSinai <- function(palette = "all", discrete = TRUE, reverse = FALSE, ...) {
  pal <- MountSinai_pal(palette = palette, reverse = reverse)
  
  if (discrete) {
    discrete_scale("colour", paste0("MountSinai_", palette), palette = pal, ...)
  } else {
    scale_color_gradientn(colours = pal(256), ...)
  }
}

# Scale Fill for ggplot insetead of scale_fill_manual 
scale_fill_MountSinai <- function(palette = "all", discrete = TRUE, reverse = FALSE, ...) {
  pal <- MountSinai_pal(palette = palette, reverse = reverse)

  if (discrete) {
    discrete_scale("fill", paste0("MountSinai_", palette), palette = pal, ...)
  } else {
    scale_fill_gradientn(colours = pal(256), ...)
  }
}

# Use in ggplot 
  # scale_color_MountSinai("main")

```


```{r Global Functions, echo = FALSE, warning = FALSE, message = FALSE}

'%!in%' <- function(x,y)!('%in%'(x,y)) # Does not include
not_all_na <- function(x) all(!is.na(x)) # Exclude columns with All NAs

```


```{r Import Data, echo = FALSE, warning = FALSE, message = FALSE}

# scheduling_data_raw <- as.data.frame(readRDS("historical_data.rds")) %>%
#   filter(!Campus %in% c("MS NOW", "MSHP", "ONCOLOGY", "MSQ", "OTHER")) %>%
#   filter(!is.na(Campus)) %>%
#   mutate(Campus = case_when(Campus == "MSDD" ~ "MSDMG",
#                             TRUE ~ Campus)) 

scheduling_data_raw <- as.data.frame(readRDS("/nfs/data/Applications/Ambulatory/Data_Updated/historical_data.rds")) %>%
  # filter(!Campus %in% c("MS NOW", "MSHP", "ONCOLOGY", "MSQ", "OTHER")) %>%
  filter(!is.na(Campus)) %>%
  mutate(Campus = case_when(Campus == "MSDD" ~ "MSDMG",
                            TRUE ~ Campus)) 
  # filter(Appt.Status %in% c("Arrived","No Show","Canceled"))
  

sites <- c("NETWORK","MSM","MSH-MSDFP","MSW","MSBI","MSUS","MSH- AMBULATORY CARE","MSDMG", "MSQ", "NYEE", "MSHP")

start_date <- "2022-01-01"
end_date <- Sys.Date()-1

holidays <- paste(unique(names(holidaysBetween(as.Date(start_date), as.Date(end_date), goodFriday = F, board = T, inaug = F, businessOnly = F)),collapse=", "))

scheduling_data_raw <- scheduling_data_raw %>%
  filter(Appt.DateYear >= as.Date(start_date) & Appt.DateYear <= end_date) 
  # mutate(holiday = isHoliday(Appt.DateYear, goodFriday = F, board = F, inaug = F, businessOnly = T)) 

scheduling_data_raw <- scheduling_data_raw %>%
  mutate(Appt.Cancel.DateYear = 
           as.Date(as.POSIXct(Appt.Cancel.DTTM,format="%Y-%m-%d %H:%M:%S",tz=Sys.timezone(),origin = "1970-01-01"), format="%Y-%m-%d")) %>%
   mutate(Appt.Status = case_when(Appt.Status == "Canceled" & Lead.Days <=0 ~ "SameDayCanceled",
  # mutate(Appt.Status = case_when(Appt.Status == "Canceled" & Appt.DateYear == as.Date(Appt.Cancel.DateYear) ~ "SameDayCanceled",
                                 TRUE ~ Appt.Status),
         Appt.Status = case_when(Appt.Status == "No Show" ~ "NoShow",
                                 TRUE ~ Appt.Status)) %>%
  mutate(wait_time_type = case_when(Wait.Time <= 0 ~ "sameDay",
                                    Wait.Time >0 & Wait.Time <15 ~ "belowFourteen",
                                    Wait.Time >=15 & Wait.Time <=30 ~ "belowThirty",
                                    TRUE ~ "overThirty"))


# Group Specialties ------------------------------------------------------------
scheduling_data_raw <- scheduling_data_raw %>%
  mutate(Campus.Specialty.Group = case_when(str_detect(Campus.Specialty, "Peds") ~ "Peds Subspecialties",
                                            Campus.Specialty %in% c("OB/Gyn","Obstetrics","Gynecology") ~ "OB/Gyn",
                                            Campus.Specialty %in% c("Family Medicine","Internal Medicine") ~ "Primary Care",
                                            Campus.Specialty %in% c("Geriatrics","Gerontology") ~ "Geriatrics",
                                            TRUE ~ Campus.Specialty)) 

```


```{r Global Variables, echo = FALSE, warning = FALSE, message = FALSE}
report_run_date <- Sys.Date()
current_year <- year(report_run_date)
last_year <- year(report_run_date)-1
```


```{r}

# comparison_data <- scheduling_data_raw %>%
#   filter(Appt.DateYear == "2022-11-02") %>%
#   filter(Provider == "COUN, DAVID") %>%
#   dplyr::select(Campus, Department, Provider, PAT_ENC_CSN_ID, MRN, Appt.DTTM, Appt.Made.DTTM, Appt.Cancel.DTTM, Appt.Status)

```


```{r Volume Variance Calculation Current Year, echo = FALSE, warning = FALSE, message = FALSE}

# By MSHS -------------------------------------------------------------------
## Volume and Variance YTD --------------------------------------------------
# arrived_calculation_ytd_site <- scheduling_data_raw %>%
#   filter(Campus %in% sites) %>%
#   filter(holiday == FALSE) %>%
#   filter(Appt.Status == "Arrived") %>%
#   filter(Appt.Day %!in% c("Sat","Sun")) %>%
#   filter(Appt.Year == current_year) %>%
#   group_by(Appt.Year, Campus, Appt.DateYear, Appt.Day) %>%
#   summarise(total = n()) %>%
#   group_by(Appt.Year, Campus, Appt.Day) %>%
#   mutate(total_day = sum(total),
#          avg_vol_day = round(mean(total))) %>% 
#   ungroup() %>%
#   group_by(Appt.Year, Campus) %>%
#   mutate(avg_vol_all = round(mean(total))) %>%
#   group_by(Appt.Year, Campus, Appt.Day, total_day, avg_vol_all, avg_vol_day) %>%
#   summarise(unique = n()) %>%
#   mutate(daily_var = round((avg_vol_day-(mean(avg_vol_all)))/(mean(avg_vol_all)),3)) %>%
#   dplyr::select(-unique)
# 
# arrived_calculation_ytd_mshs <- scheduling_data_raw %>%
#   filter(Campus %in% sites) %>%
#   filter(holiday == FALSE) %>%
#   filter(Appt.Status == "Arrived") %>%
#   filter(Appt.Day %!in% c("Sat","Sun")) %>%
#   filter(Appt.Year == current_year) %>%
#   group_by(Appt.Year, Appt.DateYear, Appt.Day) %>%
#   summarise(total = n()) %>%
#   group_by(Appt.Year, Appt.Day) %>%
#   mutate(total_day = sum(total),
#          avg_vol_day = round(mean(total))) %>% 
#   ungroup() %>%
#   group_by(Appt.Year) %>%
#   mutate(avg_vol_all = round(mean(total))) %>%
#   group_by(Appt.Year, Appt.Day, total_day, avg_vol_all, avg_vol_day) %>%
#   summarise(unique = n()) %>%
#   mutate(daily_var = round((avg_vol_day-(mean(avg_vol_all)))/(mean(avg_vol_all)),3)) %>%
#   dplyr::select(-unique) %>%
#   mutate(Campus = "MSHS Total")
# 
# arrived_calculation_ytd_merged <- bind_rows(arrived_calculation_ytd_site, arrived_calculation_ytd_mshs)
# 
# 
# ## Volume and Variance Trend --------------------------------------------------
# arrived_calculation_ytd_specialty <- scheduling_data_raw %>%
#   filter(Campus %in% sites) %>%
#   filter(holiday == FALSE) %>%
#   filter(Appt.Status == "Arrived") %>%
#   filter(Appt.Day %!in% c("Sat","Sun")) %>%
#   filter(Appt.Year == current_year) %>%
#   group_by(Appt.Year, Campus, Campus.Specialty.Group, Appt.DateYear, Appt.Day) %>%
#   summarise(total = n()) %>%
#   group_by(Appt.Year, Campus, Campus.Specialty.Group, Appt.Day) %>%
#   mutate(total_day = sum(total),
#          avg_vol_day = round(mean(total))) %>% 
#   ungroup() %>%
#   group_by(Appt.Year, Campus, Campus.Specialty.Group) %>%
#   mutate(avg_vol_all = round(mean(total))) %>%
#   group_by(Appt.Year, Campus, Campus.Specialty.Group, Appt.Day, total_day, avg_vol_all, avg_vol_day) %>%
#   summarise(unique = n()) %>%
#   mutate(daily_var = round((avg_vol_day-(mean(avg_vol_all)))/(mean(avg_vol_all)),3)) %>%
#   dplyr::select(-unique)
# 
# 
# # By Site -------------------------------------------------------------------
# arrived_calculation_trend_site <- scheduling_data_raw %>%
#   filter(Campus %in% sites) %>%
#   filter(holiday == FALSE) %>%
#   filter(Appt.Status == "Arrived") %>%
#   filter(Appt.Day %!in% c("Sat","Sun")) %>%
#   group_by(Campus, Appt.MonthYear, Appt.DateYear, Appt.Day) %>%
#   summarise(total = n()) %>%
#   group_by(Campus, Appt.MonthYear, Appt.Day) %>%
#   mutate(avg_vol_day = mean(total)) %>% 
#   ungroup() %>%
#   group_by(Campus, Appt.MonthYear) %>%
#   mutate(avg_vol_all = mean(total)) %>%
#   group_by(Campus, Appt.MonthYear, Appt.Day, avg_vol_all, avg_vol_day) %>%
#   summarise(total_vol = sum(total)) %>%
#   mutate(daily_var = round((avg_vol_day-(mean(avg_vol_all)))/(mean(avg_vol_all)),3))
# 
# 
# # By site and Specialty -----------------------------------------------------------------
# arrived_calculation_trend_specialty <- scheduling_data_raw %>%
#   filter(Campus %in% sites) %>%
#   filter(holiday == FALSE) %>%
#   filter(Appt.Status == "Arrived") %>%
#   filter(Appt.Day %!in% c("Sat","Sun")) %>%
#   group_by(Campus, Campus.Specialty.Group, Appt.MonthYear, Appt.DateYear, Appt.Day) %>%
#   summarise(total = n()) %>%
#   group_by(Campus, Campus.Specialty.Group, Appt.MonthYear, Appt.Day) %>%
#   mutate(avg_vol_day = mean(total)) %>% 
#   ungroup() %>%
#   group_by(Campus, Campus.Specialty.Group, Appt.MonthYear) %>%
#   mutate(avg_vol_all = mean(total)) %>%
#   group_by(Campus, Campus.Specialty.Group, Appt.MonthYear, Appt.Day, avg_vol_all, avg_vol_day) %>%
#   summarise(total_vol = sum(total)) %>%
#   mutate(daily_var = round((avg_vol_day-(mean(avg_vol_all)))/(mean(avg_vol_all)),3))
# 
# ```
# 
# 
# ```{r Volume Variance Calculation Last Year, echo = FALSE, warning = FALSE, message = FALSE}
# 
# # By MSHS -------------------------------------------------------------------
# ## Volume and Variance YTD --------------------------------------------------
# arrived_calculation_last_site <- scheduling_data_raw %>%
#   filter(Campus %in% sites) %>%
#   filter(holiday == FALSE) %>%
#   filter(Appt.Status == "Arrived") %>%
#   filter(Appt.Day %!in% c("Sat","Sun")) %>%
#   filter(Appt.Year == last_year) %>%
#   group_by(Appt.Year, Campus, Appt.DateYear, Appt.Day) %>%
#   summarise(total = n()) %>%
#   group_by(Appt.Year, Campus, Appt.Day) %>%
#   mutate(total_day = sum(total),
#          avg_vol_day = round(mean(total))) %>% 
#   ungroup() %>%
#   group_by(Appt.Year, Campus) %>%
#   mutate(avg_vol_all = round(mean(total))) %>%
#   group_by(Appt.Year, Campus, Appt.Day, total_day, avg_vol_all, avg_vol_day) %>%
#   summarise(unique = n()) %>%
#   mutate(daily_var = round((avg_vol_day-(mean(avg_vol_all)))/(mean(avg_vol_all)),3)) %>%
#   dplyr::select(-unique)
# 
# arrived_calculation_last_mshs <- scheduling_data_raw %>%
#   filter(Campus %in% sites) %>%
#   filter(holiday == FALSE) %>%
#   filter(Appt.Status == "Arrived") %>%
#   filter(Appt.Day %!in% c("Sat","Sun")) %>%
#   filter(Appt.Year == last_year) %>%
#   group_by(Appt.Year, Appt.DateYear, Appt.Day) %>%
#   summarise(total = n()) %>%
#   group_by(Appt.Year, Appt.Day) %>%
#   mutate(total_day = sum(total),
#          avg_vol_day = round(mean(total))) %>% 
#   ungroup() %>%
#   group_by(Appt.Year) %>%
#   mutate(avg_vol_all = round(mean(total))) %>%
#   group_by(Appt.Year, Appt.Day, total_day, avg_vol_all, avg_vol_day) %>%
#   summarise(unique = n()) %>%
#   mutate(daily_var = round((avg_vol_day-(mean(avg_vol_all)))/(mean(avg_vol_all)),3)) %>%
#   dplyr::select(-unique) %>%
#   mutate(Campus = "MSHS Total")
# 
# arrived_calculation_last_merged <- bind_rows(arrived_calculation_last_site, arrived_calculation_last_mshs)
# 
# 
# ## Volume and Variance Trend --------------------------------------------------
# arrived_calculation_last_specialty <- scheduling_data_raw %>%
#   filter(Campus %in% sites) %>%
#   filter(holiday == FALSE) %>%
#   filter(Appt.Status == "Arrived") %>%
#   filter(Appt.Day %!in% c("Sat","Sun")) %>%
#   filter(Appt.Year == last_year) %>%
#   group_by(Appt.Year, Campus, Campus.Specialty.Group, Appt.DateYear, Appt.Day) %>%
#   summarise(total = n()) %>%
#   group_by(Appt.Year, Campus, Campus.Specialty.Group, Appt.Day) %>%
#   mutate(total_day = sum(total),
#          avg_vol_day = round(mean(total))) %>% 
#   ungroup() %>%
#   group_by(Appt.Year, Campus, Campus.Specialty.Group) %>%
#   mutate(avg_vol_all = round(mean(total))) %>%
#   group_by(Appt.Year, Campus, Campus.Specialty.Group, Appt.Day, total_day, avg_vol_all, avg_vol_day) %>%
#   summarise(unique = n()) %>%
#   mutate(daily_var = round((avg_vol_day-(mean(avg_vol_all)))/(mean(avg_vol_all)),3)) %>%
#   dplyr::select(-unique)

```


```{r No Show Calculation, echo = FALSE, warning = FALSE, message = FALSE}

# By Specialty -------------------------------------------------------------------
no_show_specialty <- scheduling_data_raw %>%
  filter(Campus %in% sites) %>%
  filter(Appt.Status %in% c("Arrived", "NoShow", "SameDayCanceled", "Canceled")) %>%
  group_by(Campus, Campus.Specialty.Group, Appt.Source.New, Appt.Year, Appt.MonthYear, New.PT2, wait_time_type, Appt.Status) %>%
  summarise(total = n()) %>%
  pivot_wider(names_from = Appt.Status:wait_time_type,
              values_from = total,
              values_fill = 0) 

# Add Missing ApptStatusFinal
  nms <- c("Campus", "Campus.Specialty.Group", "Appt.Source.New", "Appt.Year", "Appt.MonthYear", "New.PT2",
          "Arrived", "Arrived_sameDay", "Arrived_belowFourteen", "Arrived_belowThirty", "Arrived_overThirty",
          "NoShow", "NoShow_sameDay", "NoShow_belowFourteen", "NoShow_belowThirty", "NoShow_overThirty",
          "SameDayCanceled", "SameDayCanceled_sameDay", "SameDayCanceled_belowFourteen", "SameDayCanceled_belowThirty", "SameDayCanceled_overThirty",
          "Canceled", "Canceled_sameDay", "Canceled_belowFourteen", "Canceled_belowThirty", "Canceled_overThirty")   # Vector of columns you want in this data.frame
  
  Missing <- setdiff(nms, names(no_show_specialty))  # Find names of missing columns
  no_show_specialty[Missing] <- 0                    # Add them, filled with '0's
  no_show_specialty <- no_show_specialty[nms]     
  

no_show_specialty <- no_show_specialty %>%
  mutate(`Arrived` = `Arrived_sameDay` + `Arrived_belowFourteen` + `Arrived_belowThirty` + `Arrived_overThirty`,
         `NoShow` = `NoShow_sameDay` + `NoShow_belowFourteen` + `NoShow_belowThirty` + `NoShow_overThirty`,
         `SameDayCanceled` = `SameDayCanceled_sameDay` + `SameDayCanceled_belowFourteen` + `SameDayCanceled_belowThirty` + `SameDayCanceled_overThirty`,
         Canceled = Canceled_sameDay + Canceled_belowFourteen + Canceled_belowThirty + Canceled_overThirty)

  
  no_show_specialty <- no_show_specialty %>%
    mutate(Total = Arrived + `NoShow` + `SameDayCanceled`,
           `Total_sameDay` = `Arrived_sameDay` + `NoShow_sameDay` + `SameDayCanceled_sameDay`,
           `Total_belowFourteen` = `Arrived_belowFourteen` + `NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`,
           `Total_belowThirty` = `Arrived_belowThirty` + `NoShow_belowThirty` + `SameDayCanceled_belowThirty`,
           `Total_overThirty` = `Arrived_overThirty` + `NoShow_overThirty` + `SameDayCanceled_overThirty`) 
  
  
  
# By Department -------------------------------------------------------------------
no_show_dept <- scheduling_data_raw %>%
  filter(Campus %in% sites) %>%
  filter(Appt.Status %in% c("Arrived", "NoShow", "SameDayCanceled", "Canceled")) %>%
  group_by(Campus, Campus.Specialty.Group, Department, Appt.Source.New, Appt.Year, Appt.MonthYear, New.PT2, wait_time_type, Appt.Status) %>%
  summarise(total = n()) %>%
  pivot_wider(names_from = Appt.Status:wait_time_type,
              values_from = total,
              values_fill = 0) 

# Add Missing ApptStatusFinal
  nms <- c("Campus", "Campus.Specialty.Group", "Department", "Appt.Source.New", "Appt.Year", "Appt.MonthYear", "New.PT2",
          "Arrived", "Arrived_sameDay", "Arrived_belowFourteen", "Arrived_belowThirty", "Arrived_overThirty",
          "NoShow", "NoShow_sameDay", "NoShow_belowFourteen", "NoShow_belowThirty", "NoShow_overThirty",
          "SameDayCanceled", "SameDayCanceled_sameDay", "SameDayCanceled_belowFourteen", "SameDayCanceled_belowThirty", "SameDayCanceled_overThirty",
           "Canceled", "Canceled_sameDay", "Canceled_belowFourteen", "Canceled_belowThirty", "Canceled_overThirty")   # Vector of columns you want in this data.frame
  
  Missing <- setdiff(nms, names(no_show_dept))  # Find names of missing columns
  no_show_dept [Missing] <- 0                    # Add them, filled with '0's
  no_show_dept  <- no_show_dept [nms]     
  
  no_show_dept <- no_show_dept %>%
  mutate(`Arrived` = `Arrived_sameDay` + `Arrived_belowFourteen` + `Arrived_belowThirty` + `Arrived_overThirty`,
         `NoShow` = `NoShow_sameDay` + `NoShow_belowFourteen` + `NoShow_belowThirty` + `NoShow_overThirty`,
         `SameDayCanceled` = `SameDayCanceled_sameDay` + `SameDayCanceled_belowFourteen` + `SameDayCanceled_belowThirty` + `SameDayCanceled_overThirty`,
         Canceled = Canceled_sameDay + Canceled_belowFourteen + Canceled_belowThirty + Canceled_overThirty)

  
  no_show_dept <- no_show_dept %>%
    mutate(Total = Arrived + `NoShow` + `SameDayCanceled`,
           `Total_sameDay` = `Arrived_sameDay` + `NoShow_sameDay` + `SameDayCanceled_sameDay`,
           `Total_belowFourteen` = `Arrived_belowFourteen` + `NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`,
           `Total_belowThirty` = `Arrived_belowThirty` + `NoShow_belowThirty` + `SameDayCanceled_belowThirty`,
           `Total_overThirty` = `Arrived_overThirty` + `NoShow_overThirty` + `SameDayCanceled_overThirty`) 

```


```{r No Show Original Calculation, echo = FALSE, warning = FALSE, message = FALSE}

# By Specialty -------------------------------------------------------------------
no_show_org_specialty <- scheduling_data_raw %>%
  filter(Campus %in% sites) %>%
  filter(Appt.Status %in% c("Arrived", "NoShow", "SameDayCanceled", "Canceled")) %>%
  group_by(Campus, Campus.Specialty.Group, Appt.Source.New, Appt.Year, Appt.MonthYear, New.PT2, wait_time_type, Appt.Status) %>%
  summarise(total = n()) %>%
  pivot_wider(names_from = Appt.Status:wait_time_type,
              values_from = total,
              values_fill = 0) 

# Add Missing ApptStatusFinal
  nms <- c("Campus", "Campus.Specialty.Group", "Appt.Source.New", "Appt.Year", "Appt.MonthYear", "New.PT2",
          "Arrived", "Arrived_sameDay", "Arrived_belowFourteen", "Arrived_belowThirty", "Arrived_overThirty",
          "NoShow", "NoShow_sameDay", "NoShow_belowFourteen", "NoShow_belowThirty", "NoShow_overThirty",
          "SameDayCanceled", "SameDayCanceled_sameDay", "SameDayCanceled_belowFourteen", "SameDayCanceled_belowThirty", "SameDayCanceled_overThirty",
          "Canceled", "Canceled_sameDay", "Canceled_belowFourteen", "Canceled_belowThirty", "Canceled_overThirty")   # Vector of columns you want in this data.frame
  
  Missing <- setdiff(nms, names(no_show_org_specialty))  # Find names of missing columns
  no_show_org_specialty[Missing] <- 0                    # Add them, filled with '0's
  no_show_org_specialty <- no_show_org_specialty[nms]     
  

no_show_org_specialty <- no_show_org_specialty %>%
  mutate(`Arrived` = `Arrived_sameDay` + `Arrived_belowFourteen` + `Arrived_belowThirty` + `Arrived_overThirty`,
         `NoShow` = `NoShow_sameDay` + `NoShow_belowFourteen` + `NoShow_belowThirty` + `NoShow_overThirty`,
         `SameDayCanceled` = `SameDayCanceled_sameDay` + `SameDayCanceled_belowFourteen` + `SameDayCanceled_belowThirty` + `SameDayCanceled_overThirty`,
         Canceled = Canceled_sameDay + Canceled_belowFourteen + Canceled_belowThirty + Canceled_overThirty)

  
  no_show_org_specialty <- no_show_org_specialty %>%
    mutate(Total = Arrived + `NoShow`,
           `Total_sameDay` = `Arrived_sameDay` + `NoShow_sameDay`,
           `Total_belowFourteen` = `Arrived_belowFourteen` + `NoShow_belowFourteen`,
           `Total_belowThirty` = `Arrived_belowThirty` + `NoShow_belowThirty`,
           `Total_overThirty` = `Arrived_overThirty` + `NoShow_overThirty`)
  
  
# By Department -------------------------------------------------------------------
no_show_org_dept <- scheduling_data_raw %>%
  filter(Campus %in% sites) %>%
  filter(Appt.Status %in% c("Arrived", "NoShow", "SameDayCanceled", "Canceled")) %>%
  group_by(Campus, Campus.Specialty.Group, Department, Appt.Source.New, Appt.Year, Appt.MonthYear, New.PT2, wait_time_type, Appt.Status) %>%
  summarise(total = n()) %>%
  pivot_wider(names_from = Appt.Status:wait_time_type,
              values_from = total,
              values_fill = 0) 

# Add Missing ApptStatusFinal
  nms <- c("Campus", "Campus.Specialty.Group", "Department", "Appt.Source.New", "Appt.Year", "Appt.MonthYear", "New.PT2",
          "Arrived", "Arrived_sameDay", "Arrived_belowFourteen", "Arrived_belowThirty", "Arrived_overThirty",
          "NoShow", "NoShow_sameDay", "NoShow_belowFourteen", "NoShow_belowThirty", "NoShow_overThirty",
          "SameDayCanceled", "SameDayCanceled_sameDay", "SameDayCanceled_belowFourteen", "SameDayCanceled_belowThirty", "SameDayCanceled_overThirty",
           "Canceled", "Canceled_sameDay", "Canceled_belowFourteen", "Canceled_belowThirty", "Canceled_overThirty")   # Vector of columns you want in this data.frame
  
  Missing <- setdiff(nms, names(no_show_org_dept))  # Find names of missing columns
  no_show_org_dept [Missing] <- 0                    # Add them, filled with '0's
  no_show_org_dept  <- no_show_org_dept[nms]     
  
  no_show_org_dept <- no_show_org_dept %>%
  mutate(`Arrived` = `Arrived_sameDay` + `Arrived_belowFourteen` + `Arrived_belowThirty` + `Arrived_overThirty`,
         `NoShow` = `NoShow_sameDay` + `NoShow_belowFourteen` + `NoShow_belowThirty` + `NoShow_overThirty`,
         `SameDayCanceled` = `SameDayCanceled_sameDay` + `SameDayCanceled_belowFourteen` + `SameDayCanceled_belowThirty` + `SameDayCanceled_overThirty`,
         Canceled = Canceled_sameDay + Canceled_belowFourteen + Canceled_belowThirty + Canceled_overThirty)

  
  no_show_org_dept <- no_show_org_dept %>%
    mutate(Total= Arrived + `NoShow`,
           `Total_sameDay` = `Arrived_sameDay` + `NoShow_sameDay`,
           `Total_belowFourteen` = `Arrived_belowFourteen` + `NoShow_belowFourteen`,
           `Total_belowThirty` = `Arrived_belowThirty` + `NoShow_belowThirty`,
           `Total_overThirty` = `Arrived_overThirty` + `NoShow_overThirty`) 

```


```{r No Show All Statuses Calculation, echo = FALSE, warning = FALSE, message = FALSE}

# By Specialty -------------------------------------------------------------------
no_show_all_specialty <- scheduling_data_raw %>%
  filter(Campus %in% sites) %>%
  mutate(Appt.Status = case_when(Appt.Status %in% c("Arrived", "NoShow", "SameDayCanceled", "Canceled") ~ Appt.Status,
                                 TRUE ~ "Other")) %>%
  # filter(Appt.Status %in% c("Arrived", "NoShow", "SameDayCanceled", "Canceled")) %>%
  group_by(Campus, Campus.Specialty.Group, Appt.Source.New, Appt.Year, Appt.MonthYear, New.PT2, wait_time_type, Appt.Status) %>%
  summarise(total = n()) %>%
  pivot_wider(names_from = Appt.Status:wait_time_type,
              values_from = total,
              values_fill = 0) 

# Add Missing ApptStatusFinal
  nms <- c("Campus", "Campus.Specialty.Group", "Appt.Source.New", "Appt.Year", "Appt.MonthYear", "New.PT2",
          "Arrived", "Arrived_sameDay", "Arrived_belowFourteen", "Arrived_belowThirty", "Arrived_overThirty",
          "NoShow", "NoShow_sameDay", "NoShow_belowFourteen", "NoShow_belowThirty", "NoShow_overThirty",
          "SameDayCanceled", "SameDayCanceled_sameDay", "SameDayCanceled_belowFourteen", "SameDayCanceled_belowThirty", "SameDayCanceled_overThirty",
          "Canceled", "Canceled_sameDay", "Canceled_belowFourteen", "Canceled_belowThirty", "Canceled_overThirty",
          "Other", "Other_sameDay", "Other_belowFourteen", "Other_belowThirty", "Other_overThirty")   # Vector of columns you want in this data.frame
  
  Missing <- setdiff(nms, names(no_show_all_specialty))  # Find names of missing columns
  no_show_all_specialty[Missing] <- 0                    # Add them, filled with '0's
  no_show_all_specialty <- no_show_all_specialty[nms]     
  

no_show_all_specialty <- no_show_all_specialty %>%
  mutate(`Arrived` = `Arrived_sameDay` + `Arrived_belowFourteen` + `Arrived_belowThirty` + `Arrived_overThirty`,
         `NoShow` = `NoShow_sameDay` + `NoShow_belowFourteen` + `NoShow_belowThirty` + `NoShow_overThirty`,
         `SameDayCanceled` = `SameDayCanceled_sameDay` + `SameDayCanceled_belowFourteen` + `SameDayCanceled_belowThirty` + `SameDayCanceled_overThirty`,
         Canceled = Canceled_sameDay + Canceled_belowFourteen + Canceled_belowThirty + Canceled_overThirty,
         Other = Other_sameDay + Other_belowFourteen + Other_belowThirty + Other_overThirty)

  
  no_show_all_specialty <- no_show_all_specialty %>%
    mutate(Total = Arrived + `NoShow` + `SameDayCanceled` + Canceled + Other,
           `Total_sameDay` = `Arrived_sameDay` + `NoShow_sameDay` + `SameDayCanceled_sameDay` + `Canceled_sameDay` + `Other_sameDay`,
           `Total_belowFourteen` = `Arrived_belowFourteen` + `NoShow_belowFourteen` + `SameDayCanceled_belowFourteen` + `Canceled_belowFourteen` + `Other_belowFourteen`,
           `Total_belowThirty` = `Arrived_belowThirty` + `NoShow_belowThirty` + `SameDayCanceled_belowThirty` + `Canceled_belowThirty` + `Other_belowThirty`,
           `Total_overThirty` = `Arrived_overThirty` + `NoShow_overThirty` + `SameDayCanceled_overThirty`+ `Canceled_overThirty` + `Other_overThirty`) 
  
  
# By Department -------------------------------------------------------------------
no_show_all_dept <- scheduling_data_raw %>%
  filter(Campus %in% sites) %>%
    mutate(Appt.Status = case_when(Appt.Status %in% c("Arrived", "NoShow", "SameDayCanceled", "Canceled") ~ Appt.Status,
                                 TRUE ~ "Other")) %>%
  # filter(Appt.Status %in% c("Arrived", "NoShow", "SameDayCanceled", "Canceled")) %>%
  group_by(Campus, Campus.Specialty.Group, Department, Appt.Source.New, Appt.Year, Appt.MonthYear, New.PT2, wait_time_type, Appt.Status) %>%
  summarise(total = n()) %>%
  pivot_wider(names_from = Appt.Status:wait_time_type,
              values_from = total,
              values_fill = 0) 

# Add Missing ApptStatusFinal
  nms <- c("Campus", "Campus.Specialty.Group", "Department", "Appt.Source.New", "Appt.Year", "Appt.MonthYear", "New.PT2",
          "Arrived", "Arrived_sameDay", "Arrived_belowFourteen", "Arrived_belowThirty", "Arrived_overThirty",
          "NoShow", "NoShow_sameDay", "NoShow_belowFourteen", "NoShow_belowThirty", "NoShow_overThirty",
          "SameDayCanceled", "SameDayCanceled_sameDay", "SameDayCanceled_belowFourteen", "SameDayCanceled_belowThirty", "SameDayCanceled_overThirty",
           "Canceled", "Canceled_sameDay", "Canceled_belowFourteen", "Canceled_belowThirty", "Canceled_overThirty",
          "Other", "Other_sameDay", "Other_belowFourteen", "Other_belowThirty", "Other_overThirty")   # Vector of columns you want in this data.frame
  
  Missing <- setdiff(nms, names(no_show_all_dept))  # Find names of missing columns
  no_show_all_dept [Missing] <- 0                    # Add them, filled with '0's
  no_show_all_dept  <- no_show_all_dept[nms]     
  
  no_show_all_dept <- no_show_all_dept %>%
  mutate(`Arrived` = `Arrived_sameDay` + `Arrived_belowFourteen` + `Arrived_belowThirty` + `Arrived_overThirty`,
         `NoShow` = `NoShow_sameDay` + `NoShow_belowFourteen` + `NoShow_belowThirty` + `NoShow_overThirty`,
         `SameDayCanceled` = `SameDayCanceled_sameDay` + `SameDayCanceled_belowFourteen` + `SameDayCanceled_belowThirty` + `SameDayCanceled_overThirty`,
         Canceled = Canceled_sameDay + Canceled_belowFourteen + Canceled_belowThirty + Canceled_overThirty,
         Other = Other_sameDay + Other_belowFourteen + Other_belowThirty + Other_overThirty)

  
  no_show_all_dept <- no_show_all_dept %>%
    mutate(Total = Arrived + `NoShow` + `SameDayCanceled` + Canceled + Other,
           `Total_sameDay` = `Arrived_sameDay` + `NoShow_sameDay` + `SameDayCanceled_sameDay` + `Canceled_sameDay` + `Other_sameDay`,
           `Total_belowFourteen` = `Arrived_belowFourteen` + `NoShow_belowFourteen` + `SameDayCanceled_belowFourteen` + `Canceled_belowFourteen` + `Other_belowFourteen`,
           `Total_belowThirty` = `Arrived_belowThirty` + `NoShow_belowThirty` + `SameDayCanceled_belowThirty` + `Canceled_belowThirty` + `Other_belowThirty`,
           `Total_overThirty` = `Arrived_overThirty` + `NoShow_overThirty` + `SameDayCanceled_overThirty`+ `Canceled_overThirty` + `Other_overThirty`) 

```


```{r Sinai Logo, echo=FALSE, out.width = '15%'}
knitr::include_graphics("Mount_Sinai_Logo_H.png")
```


# Ambulatory No Show Report
*Report run date: `r report_run_date`*<br/>
*Report date range: `r start_date` to `r end_date`*<br/>
*Excludes Rad Onc and Radiology data*<br/>
*Excludes eIDX, MD Office data.*<br/>
______________________________________________________________________________________________________________________________
<br/>
<br/>

## MSHS
### No Show Plus Rate {.tabset .tabset-fade .tabset-pills}
#### `r current_year` YTD
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Site**</span><br/>
```{r MSHS No Show Current Year Output, echo = FALSE, warning = FALSE, message = FALSE}

no_show_ytd_site <- no_show_specialty %>%
  filter(Appt.Year == current_year) %>%
  group_by(Campus, Campus.Specialty.Group, New.PT2) %>%
  summarise(Arrived = sum(Arrived),
            `Arrived_sameDay` = sum(`Arrived_sameDay`),
            `Arrived_belowFourteen` = sum(`Arrived_belowFourteen`),
            `Arrived_belowThirty` = sum(`Arrived_belowThirty`),
            `Arrived_overThirty` = sum(`Arrived_overThirty`),
            `NoShow` = sum(`NoShow`),
            `NoShow_sameDay` = sum(`NoShow_sameDay`),
            `NoShow_belowFourteen` = sum(`NoShow_belowFourteen`),
            `NoShow_belowThirty` = sum(`NoShow_belowThirty`),
            `NoShow_overThirty` = sum(`NoShow_overThirty`),
            `SameDayCanceled` = sum(`SameDayCanceled`),
            `SameDayCanceled_sameDay` = sum(`SameDayCanceled_sameDay`),
            `SameDayCanceled_belowFourteen` = sum(`SameDayCanceled_belowFourteen`),
            `SameDayCanceled_belowThirty` = sum(`SameDayCanceled_belowThirty`),
            `SameDayCanceled_overThirty` = sum(`SameDayCanceled_overThirty`),
            Total = sum(Total),
            `Total_sameDay` = sum(`Total_sameDay`),
            `Total_belowFourteen` = sum(`Total_belowFourteen`),
            `Total_belowThirty` = sum(`Total_belowThirty`),
            `Total_overThirty` = sum(`Total_overThirty`)) %>%
  mutate(noShow_rate = round((`NoShow` + `SameDayCanceled`)/ Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/ `Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/ `Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/ `Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/ `Total_overThirty`,3)) %>%
  pivot_wider(names_from = New.PT2,
              values_from = 4:28,
              values_fill = 0) %>%
  mutate(Total = (Total_Established + Total_New),
         `Total_sameDay` = (`Total_sameDay_Established` + `Total_sameDay_New`),
         `Total_belowFourteen` = (`Total_belowFourteen_Established` + `Total_belowFourteen_New`),
         `Total_belowThirty` = (`Total_belowThirty_Established` + `Total_belowThirty_New`),
         `Total_overThirty` = (`Total_overThirty_Established` + `Total_overThirty_New`),
         Arrived = (Arrived_Established + Arrived_New),
         `Arrived_sameDay` = (`Arrived_sameDay_Established` + `Arrived_sameDay_New`),
         `Arrived_belowFourteen` = (`Arrived_belowFourteen_Established` + `Arrived_belowFourteen_New`),
         `Arrived_belowThirty` = (`Arrived_belowThirty_Established` + `Arrived_belowThirty_New`),
         `Arrived_overThirty` = (`Arrived_overThirty_Established` + `Arrived_overThirty_New`),
         NoShow = (NoShow_Established + NoShow_New),
         `NoShow_sameDay` = (`NoShow_sameDay_Established` + `NoShow_sameDay_New`),
         `NoShow_belowFourteen` = (`NoShow_belowFourteen_Established` + `NoShow_belowFourteen_New`),
         `NoShow_belowThirty` = (`NoShow_belowThirty_Established` + `NoShow_belowThirty_New`),
         `NoShow_overThirty` = (`NoShow_overThirty_Established` + `NoShow_overThirty_New`),
         SameDayCanceled = (SameDayCanceled_Established + SameDayCanceled_New),
         `SameDayCanceled_sameDay` = (`SameDayCanceled_sameDay_Established` + `SameDayCanceled_sameDay_New`),
         `SameDayCanceled_belowFourteen` = (`SameDayCanceled_belowFourteen_Established` + `SameDayCanceled_belowFourteen_New`),
         `SameDayCanceled_belowThirty` = (`SameDayCanceled_belowThirty_Established` + `SameDayCanceled_belowThirty_New`),
         `SameDayCanceled_overThirty` = (`SameDayCanceled_overThirty_Established` + `SameDayCanceled_overThirty_New`),
         noShow_rate = round((`NoShow_Established` + `SameDayCanceled_Established` + `NoShow_New` + `SameDayCanceled_New`)/Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/`Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/`Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/`Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/`Total_overThirty`,3),
         new_perc = round(Arrived_New/Arrived,3)) %>%
  group_by(Campus) %>%
  mutate(arrived_site = sum(Arrived),
         arrived_perc = round(Arrived/arrived_site,3)) 


no_show_ytd_mshs <- no_show_specialty %>%
  filter(Appt.Year == current_year) %>%
  group_by(Campus.Specialty.Group, New.PT2) %>%
  summarise(Arrived = sum(Arrived),
            `Arrived_sameDay` = sum(`Arrived_sameDay`),
            `Arrived_belowFourteen` = sum(`Arrived_belowFourteen`),
            `Arrived_belowThirty` = sum(`Arrived_belowThirty`),
            `Arrived_overThirty` = sum(`Arrived_overThirty`),
            `NoShow` = sum(`NoShow`),
            `NoShow_sameDay` = sum(`NoShow_sameDay`),
            `NoShow_belowFourteen` = sum(`NoShow_belowFourteen`),
            `NoShow_belowThirty` = sum(`NoShow_belowThirty`),
            `NoShow_overThirty` = sum(`NoShow_overThirty`),
            `SameDayCanceled` = sum(`SameDayCanceled`),
            `SameDayCanceled_sameDay` = sum(`SameDayCanceled_sameDay`),
            `SameDayCanceled_belowFourteen` = sum(`SameDayCanceled_belowFourteen`),
            `SameDayCanceled_belowThirty` = sum(`SameDayCanceled_belowThirty`),
            `SameDayCanceled_overThirty` = sum(`SameDayCanceled_overThirty`),
            Total = sum(Total),
            `Total_sameDay` = sum(`Total_sameDay`),
            `Total_belowFourteen` = sum(`Total_belowFourteen`),
            `Total_belowThirty` = sum(`Total_belowThirty`),
            `Total_overThirty` = sum(`Total_overThirty`)) %>%
  mutate(noShow_rate = round((`NoShow` + `SameDayCanceled`)/ Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/ `Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/ `Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/ `Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/ `Total_overThirty`,3)) %>%
  pivot_wider(names_from = New.PT2,
              values_from = 3:27,
              values_fill = 0) %>%
  mutate(Total = (Total_Established + Total_New),
         `Total_sameDay` = (`Total_sameDay_Established` + `Total_sameDay_New`),
         `Total_belowFourteen` = (`Total_belowFourteen_Established` + `Total_belowFourteen_New`),
         `Total_belowThirty` = (`Total_belowThirty_Established` + `Total_belowThirty_New`),
         `Total_overThirty` = (`Total_overThirty_Established` + `Total_overThirty_New`),
         Arrived = (Arrived_Established + Arrived_New),
         `Arrived_sameDay` = (`Arrived_sameDay_Established` + `Arrived_sameDay_New`),
         `Arrived_belowFourteen` = (`Arrived_belowFourteen_Established` + `Arrived_belowFourteen_New`),
         `Arrived_belowThirty` = (`Arrived_belowThirty_Established` + `Arrived_belowThirty_New`),
         `Arrived_overThirty` = (`Arrived_overThirty_Established` + `Arrived_overThirty_New`),
         NoShow = (NoShow_Established + NoShow_New),
         `NoShow_sameDay` = (`NoShow_sameDay_Established` + `NoShow_sameDay_New`),
         `NoShow_belowFourteen` = (`NoShow_belowFourteen_Established` + `NoShow_belowFourteen_New`),
         `NoShow_belowThirty` = (`NoShow_belowThirty_Established` + `NoShow_belowThirty_New`),
         `NoShow_overThirty` = (`NoShow_overThirty_Established` + `NoShow_overThirty_New`),
         SameDayCanceled = (SameDayCanceled_Established + SameDayCanceled_New),
         `SameDayCanceled_sameDay` = (`SameDayCanceled_sameDay_Established` + `SameDayCanceled_sameDay_New`),
         `SameDayCanceled_belowFourteen` = (`SameDayCanceled_belowFourteen_Established` + `SameDayCanceled_belowFourteen_New`),
         `SameDayCanceled_belowThirty` = (`SameDayCanceled_belowThirty_Established` + `SameDayCanceled_belowThirty_New`),
         `SameDayCanceled_overThirty` = (`SameDayCanceled_overThirty_Established` + `SameDayCanceled_overThirty_New`),
         noShow_rate = round((`NoShow_Established` + `SameDayCanceled_Established` + `NoShow_New` + `SameDayCanceled_New`)/Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/`Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/`Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/`Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/`Total_overThirty`,3),
         new_perc = round(Arrived_New/Arrived,3)) %>%
  mutate(Campus = "MSHS Total") %>%
  group_by(Campus) %>%
  mutate(arrived_site = sum(Arrived),
         arrived_perc = round(Arrived/arrived_site,3)) 


no_show_ytd_merged <- bind_rows(no_show_ytd_site, no_show_ytd_mshs)

no_show_ytd_merged <- no_show_ytd_merged %>%
  dplyr::select(1:2, 58, 78, 80, 
                3:57, 59:77, 79)



# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('mshs_ytd_noshow-download-table', 'Avg No Show Rate')"
    ),

# htmltools::browsable(
#   tagList(
#     div(tags$label("Group by", `for` = "cars-grouping-select")),
#     tags$select(
#       id = "cars-grouping-select",
#       onchange = "Reactable.setGroupBy('cars-grouping-table', this.value ? [this.value] : [])",
#       tags$option("None", value = c("Campus","Campus.Specialty.Group")),
#       # tags$option("Test", value = c("Appt.Source.New","Campus.Specialty.Group")),
#       # lapply(c("Campus", "Campus.Specialty.Group", "Appt.Source.New"), tags$option)
#       lapply(c("Campus", "Campus.Specialty.Group", "Appt.Source.New"), tags$option)
#     ),
# 
#     tags$hr("aria-hidden" = "true"),

reactable(
  no_show_ytd_merged,
  elementId = "mshs_ytd_noshow-download-table",
  # elementId = "cars-grouping-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,
  
  rowStyle = function(index) {
            if (index %in% c(10)) {
              list(`border-top` = "2px solid rgb(184,184,184)",
                   fontWeight = "Bold")
            }
          },

  groupBy = c("Campus"),

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group"), sticky = "left", 
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(current_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus = colDef(
      # footer = "Total",
      name = "Site",
      minWidth = 200),

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    # Appt.Source.New = colDef(
    #   name = "Source",
    #   minWidth = 100),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)

```
<br/>
<br/>
<br/>


<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r MSHS No Show by Specialty Current Year Output, echo = FALSE, warning = FALSE, message = FALSE}

# no_show_ytd_specialty <- no_show_specialty %>%
#   filter(Appt.Year == current_year) %>%
#   group_by(Campus.Specialty.Group, Campus, New.PT2) %>%
#   summarise(Arrived = sum(Arrived),
#             `NoShow` = sum(`No Show`),
#             `SameDayCanceled` = sum(`Same-Day Canceled`),
#             Total = sum(Total)) %>%
#   mutate(noShow_rate = round((`NoShow` + `SameDayCanceled`)/ Total,3)) %>%
#   pivot_wider(names_from = New.PT2,
#               values_from = 4:8,
#               values_fill = 0) %>%
#   mutate(Total = (Total_Established + Total_New),
#          Arrived = (Arrived_Established + Arrived_New),
#          noShow_rate = round((`NoShow_Established` + `SameDayCanceled_Established` + `NoShow_New` + `SameDayCanceled_New`)/Total,3),
#          new_perc = round(Arrived_New/Arrived,3)) %>%
#   group_by(Campus.Specialty.Group) %>%
#   mutate(arrived_site = sum(Arrived),
#          arrived_perc = round(Arrived/arrived_site,3)) 

no_show_ytd_specialty <- no_show_specialty %>%
  filter(Appt.Year == current_year) %>%
  group_by(Campus.Specialty.Group, Campus, New.PT2) %>%
  summarise(Arrived = sum(Arrived),
            `Arrived_sameDay` = sum(`Arrived_sameDay`),
            `Arrived_belowFourteen` = sum(`Arrived_belowFourteen`),
            `Arrived_belowThirty` = sum(`Arrived_belowThirty`),
            `Arrived_overThirty` = sum(`Arrived_overThirty`),
            `NoShow` = sum(`NoShow`),
            `NoShow_sameDay` = sum(`NoShow_sameDay`),
            `NoShow_belowFourteen` = sum(`NoShow_belowFourteen`),
            `NoShow_belowThirty` = sum(`NoShow_belowThirty`),
            `NoShow_overThirty` = sum(`NoShow_overThirty`),
            `SameDayCanceled` = sum(`SameDayCanceled`),
            `SameDayCanceled_sameDay` = sum(`SameDayCanceled_sameDay`),
            `SameDayCanceled_belowFourteen` = sum(`SameDayCanceled_belowFourteen`),
            `SameDayCanceled_belowThirty` = sum(`SameDayCanceled_belowThirty`),
            `SameDayCanceled_overThirty` = sum(`SameDayCanceled_overThirty`),
            Total = sum(Total),
            `Total_sameDay` = sum(`Total_sameDay`),
            `Total_belowFourteen` = sum(`Total_belowFourteen`),
            `Total_belowThirty` = sum(`Total_belowThirty`),
            `Total_overThirty` = sum(`Total_overThirty`)) %>%
  mutate(noShow_rate = round((`NoShow` + `SameDayCanceled`)/ Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/ `Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/ `Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/ `Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/ `Total_overThirty`,3)) %>%
  pivot_wider(names_from = New.PT2,
              values_from = 4:28,
              values_fill = 0) %>%
  mutate(Total = (Total_Established + Total_New),
         `Total_sameDay` = (`Total_sameDay_Established` + `Total_sameDay_New`),
         `Total_belowFourteen` = (`Total_belowFourteen_Established` + `Total_belowFourteen_New`),
         `Total_belowThirty` = (`Total_belowThirty_Established` + `Total_belowThirty_New`),
         `Total_overThirty` = (`Total_overThirty_Established` + `Total_overThirty_New`),
         Arrived = (Arrived_Established + Arrived_New),
         `Arrived_sameDay` = (`Arrived_sameDay_Established` + `Arrived_sameDay_New`),
         `Arrived_belowFourteen` = (`Arrived_belowFourteen_Established` + `Arrived_belowFourteen_New`),
         `Arrived_belowThirty` = (`Arrived_belowThirty_Established` + `Arrived_belowThirty_New`),
         `Arrived_overThirty` = (`Arrived_overThirty_Established` + `Arrived_overThirty_New`),
         NoShow = (NoShow_Established + NoShow_New),
         `NoShow_sameDay` = (`NoShow_sameDay_Established` + `NoShow_sameDay_New`),
         `NoShow_belowFourteen` = (`NoShow_belowFourteen_Established` + `NoShow_belowFourteen_New`),
         `NoShow_belowThirty` = (`NoShow_belowThirty_Established` + `NoShow_belowThirty_New`),
         `NoShow_overThirty` = (`NoShow_overThirty_Established` + `NoShow_overThirty_New`),
         SameDayCanceled = (SameDayCanceled_Established + SameDayCanceled_New),
         `SameDayCanceled_sameDay` = (`SameDayCanceled_sameDay_Established` + `SameDayCanceled_sameDay_New`),
         `SameDayCanceled_belowFourteen` = (`SameDayCanceled_belowFourteen_Established` + `SameDayCanceled_belowFourteen_New`),
         `SameDayCanceled_belowThirty` = (`SameDayCanceled_belowThirty_Established` + `SameDayCanceled_belowThirty_New`),
         `SameDayCanceled_overThirty` = (`SameDayCanceled_overThirty_Established` + `SameDayCanceled_overThirty_New`),
         noShow_rate = round((`NoShow_Established` + `SameDayCanceled_Established` + `NoShow_New` + `SameDayCanceled_New`)/Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/`Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/`Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/`Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/`Total_overThirty`,3),
         new_perc = round(Arrived_New/Arrived,3)) %>%
  group_by(Campus.Specialty.Group) %>%
  mutate(arrived_site = sum(Arrived),
         arrived_perc = round(Arrived/arrived_site,3)) 

no_show_ytd_specialty <- no_show_ytd_specialty %>%
  dplyr::select(1:2, 58, 78, 80, 
                3:57, 59:77, 79)


# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('mshs_ytd_noshow_specialty-download-table', 'Avg No Show Rate')"
    ),

# htmltools::browsable(
#   tagList(
#     div(tags$label("Group by", `for` = "cars-grouping-select")),
#     tags$select(
#       id = "cars-grouping-select",
#       onchange = "Reactable.setGroupBy('cars-grouping-table', this.value ? [this.value] : [])",
#       tags$option("None", value = c("Campus","Campus.Specialty.Group","Appt.Source.New")),
#       # tags$option("Test", value = c("Appt.Source.New","Campus.Specialty.Group")),
#       # lapply(c("Campus", "Campus.Specialty.Group", "Appt.Source.New"), tags$option)
#       lapply(c("Campus", "Campus.Specialty.Group", "Appt.Source.New"), tags$option)
#     ),
# 
#     tags$hr("aria-hidden" = "true"),

reactable(
  no_show_ytd_specialty,
  elementId = "mshs_ytd_noshow_specialty-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,
  
  # rowStyle = function(index) {
  #           if (index %in% c(10)) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },

  groupBy = c("Campus.Specialty.Group"),

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(current_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Campus = colDef(
      name = "Site",
      minWidth = 150),
    
    # Appt.Source.New = colDef(
    #   name = "Appt Source",
    #   minWidth = 100),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Specialty Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)
```
<br/>
<br/>
<br/>

<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Group**</span><br/>
```{r MSHS No Show by Group Current Year Output, echo = FALSE, warning = FALSE, message = FALSE}

no_show_ytd_specialty_group <- no_show_specialty %>%
  filter(Appt.Year == current_year) %>%
  group_by(Campus.Specialty.Group, Campus, Appt.Source.New, New.PT2) %>%
  summarise(Arrived = sum(Arrived),
            `Arrived_sameDay` = sum(`Arrived_sameDay`),
            `Arrived_belowFourteen` = sum(`Arrived_belowFourteen`),
            `Arrived_belowThirty` = sum(`Arrived_belowThirty`),
            `Arrived_overThirty` = sum(`Arrived_overThirty`),
            `NoShow` = sum(`NoShow`),
            `NoShow_sameDay` = sum(`NoShow_sameDay`),
            `NoShow_belowFourteen` = sum(`NoShow_belowFourteen`),
            `NoShow_belowThirty` = sum(`NoShow_belowThirty`),
            `NoShow_overThirty` = sum(`NoShow_overThirty`),
            `SameDayCanceled` = sum(`SameDayCanceled`),
            `SameDayCanceled_sameDay` = sum(`SameDayCanceled_sameDay`),
            `SameDayCanceled_belowFourteen` = sum(`SameDayCanceled_belowFourteen`),
            `SameDayCanceled_belowThirty` = sum(`SameDayCanceled_belowThirty`),
            `SameDayCanceled_overThirty` = sum(`SameDayCanceled_overThirty`),
            Total = sum(Total),
            `Total_sameDay` = sum(`Total_sameDay`),
            `Total_belowFourteen` = sum(`Total_belowFourteen`),
            `Total_belowThirty` = sum(`Total_belowThirty`),
            `Total_overThirty` = sum(`Total_overThirty`)) %>%
  mutate(noShow_rate = round((`NoShow` + `SameDayCanceled`)/ Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/ `Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/ `Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/ `Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/ `Total_overThirty`,3)) %>%
  pivot_wider(names_from = New.PT2,
              values_from = 5:29,
              values_fill = 0) %>%
  mutate(Total = (Total_Established + Total_New),
         `Total_sameDay` = (`Total_sameDay_Established` + `Total_sameDay_New`),
         `Total_belowFourteen` = (`Total_belowFourteen_Established` + `Total_belowFourteen_New`),
         `Total_belowThirty` = (`Total_belowThirty_Established` + `Total_belowThirty_New`),
         `Total_overThirty` = (`Total_overThirty_Established` + `Total_overThirty_New`),
         Arrived = (Arrived_Established + Arrived_New),
         `Arrived_sameDay` = (`Arrived_sameDay_Established` + `Arrived_sameDay_New`),
         `Arrived_belowFourteen` = (`Arrived_belowFourteen_Established` + `Arrived_belowFourteen_New`),
         `Arrived_belowThirty` = (`Arrived_belowThirty_Established` + `Arrived_belowThirty_New`),
         `Arrived_overThirty` = (`Arrived_overThirty_Established` + `Arrived_overThirty_New`),
         NoShow = (NoShow_Established + NoShow_New),
         `NoShow_sameDay` = (`NoShow_sameDay_Established` + `NoShow_sameDay_New`),
         `NoShow_belowFourteen` = (`NoShow_belowFourteen_Established` + `NoShow_belowFourteen_New`),
         `NoShow_belowThirty` = (`NoShow_belowThirty_Established` + `NoShow_belowThirty_New`),
         `NoShow_overThirty` = (`NoShow_overThirty_Established` + `NoShow_overThirty_New`),
         SameDayCanceled = (SameDayCanceled_Established + SameDayCanceled_New),
         `SameDayCanceled_sameDay` = (`SameDayCanceled_sameDay_Established` + `SameDayCanceled_sameDay_New`),
         `SameDayCanceled_belowFourteen` = (`SameDayCanceled_belowFourteen_Established` + `SameDayCanceled_belowFourteen_New`),
         `SameDayCanceled_belowThirty` = (`SameDayCanceled_belowThirty_Established` + `SameDayCanceled_belowThirty_New`),
         `SameDayCanceled_overThirty` = (`SameDayCanceled_overThirty_Established` + `SameDayCanceled_overThirty_New`),
         noShow_rate = round((`NoShow_Established` + `SameDayCanceled_Established` + `NoShow_New` + `SameDayCanceled_New`)/Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/`Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/`Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/`Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/`Total_overThirty`,3),
         new_perc = round(Arrived_New/Arrived,3)) %>%
  group_by(Campus, Campus.Specialty.Group) %>%
  mutate(arrived_site = sum(Arrived),
         arrived_perc = round(Arrived/arrived_site,3)) 

no_show_ytd_specialty_group <- no_show_ytd_specialty_group %>%
  dplyr::select(1:3, 59, 79, 81, 
                4:58, 60:78, 80)

# Table Output -----------------------------------------------------------------
# htmltools::browsable(
#   tagList(
#     tags$button(
#       tagList(fontawesome::fa("download"), "Download Table"),
#       onclick = "Reactable.downloadDataCSV('mshs_ytd_noshow_group-download-table', 'Avg No Show Rate')"
#     ),

htmltools::browsable(
  tagList(
    div(tags$label("Group by", `for` = "mshs_ytd_noshow_group-select")),
    tags$select(
      id = "mshs_ytd_noshow_group-select",
      onchange = "Reactable.setGroupBy('mshs_ytd_noshow_group-table', this.value ? [this.value] : [])",
      tags$option("None", value = c("Campus","Campus.Specialty.Group")),
      # tags$option("Test", value = c("Appt.Source.New","Campus.Specialty.Group")),
      # lapply(c("Campus", "Campus.Specialty.Group", "Appt.Source.New"), tags$option)
      lapply(c("Campus", "Campus.Specialty.Group", "Appt.Source.New"), tags$option)
    ),

    tags$hr("aria-hidden" = "true"),

reactable(
  no_show_ytd_specialty_group ,
  # elementId = "mshs_ytd_noshow_group-download-table",
  elementId = "mshs_ytd_noshow_group-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 900,
    wrap = TRUE,
  searchable = TRUE,
  
  # rowStyle = function(index) {
  #           if (index %in% c(10)) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },

  groupBy = c("Campus.Specialty.Group","Campus"),

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Appt.Source.New"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(current_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Campus = colDef(
      name = "Site",
      minWidth = 150),
    
    Appt.Source.New = colDef(
      name = "Appt Source",
      minWidth = 100),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)

```
<br/>
<br/>
<br/>

#### `r last_year` 
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Site**</span><br/>
```{r MSHS No Show Last Year Output, echo = FALSE, warning = FALSE, message = FALSE}

no_show_last_site <- no_show_specialty %>%
  filter(Appt.Year == last_year) %>%
  group_by(Campus, Campus.Specialty.Group, New.PT2) %>%
  summarise(Arrived = sum(Arrived),
            `Arrived_sameDay` = sum(`Arrived_sameDay`),
            `Arrived_belowFourteen` = sum(`Arrived_belowFourteen`),
            `Arrived_belowThirty` = sum(`Arrived_belowThirty`),
            `Arrived_overThirty` = sum(`Arrived_overThirty`),
            `NoShow` = sum(`NoShow`),
            `NoShow_sameDay` = sum(`NoShow_sameDay`),
            `NoShow_belowFourteen` = sum(`NoShow_belowFourteen`),
            `NoShow_belowThirty` = sum(`NoShow_belowThirty`),
            `NoShow_overThirty` = sum(`NoShow_overThirty`),
            `SameDayCanceled` = sum(`SameDayCanceled`),
            `SameDayCanceled_sameDay` = sum(`SameDayCanceled_sameDay`),
            `SameDayCanceled_belowFourteen` = sum(`SameDayCanceled_belowFourteen`),
            `SameDayCanceled_belowThirty` = sum(`SameDayCanceled_belowThirty`),
            `SameDayCanceled_overThirty` = sum(`SameDayCanceled_overThirty`),
            Total = sum(Total),
            `Total_sameDay` = sum(`Total_sameDay`),
            `Total_belowFourteen` = sum(`Total_belowFourteen`),
            `Total_belowThirty` = sum(`Total_belowThirty`),
            `Total_overThirty` = sum(`Total_overThirty`)) %>%
  mutate(noShow_rate = round((`NoShow` + `SameDayCanceled`)/ Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/ `Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/ `Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/ `Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/ `Total_overThirty`,3)) %>%
  pivot_wider(names_from = New.PT2,
              values_from = 4:28,
              values_fill = 0) %>%
  mutate(Total = (Total_Established + Total_New),
         `Total_sameDay` = (`Total_sameDay_Established` + `Total_sameDay_New`),
         `Total_belowFourteen` = (`Total_belowFourteen_Established` + `Total_belowFourteen_New`),
         `Total_belowThirty` = (`Total_belowThirty_Established` + `Total_belowThirty_New`),
         `Total_overThirty` = (`Total_overThirty_Established` + `Total_overThirty_New`),
         Arrived = (Arrived_Established + Arrived_New),
         `Arrived_sameDay` = (`Arrived_sameDay_Established` + `Arrived_sameDay_New`),
         `Arrived_belowFourteen` = (`Arrived_belowFourteen_Established` + `Arrived_belowFourteen_New`),
         `Arrived_belowThirty` = (`Arrived_belowThirty_Established` + `Arrived_belowThirty_New`),
         `Arrived_overThirty` = (`Arrived_overThirty_Established` + `Arrived_overThirty_New`),
         NoShow = (NoShow_Established + NoShow_New),
         `NoShow_sameDay` = (`NoShow_sameDay_Established` + `NoShow_sameDay_New`),
         `NoShow_belowFourteen` = (`NoShow_belowFourteen_Established` + `NoShow_belowFourteen_New`),
         `NoShow_belowThirty` = (`NoShow_belowThirty_Established` + `NoShow_belowThirty_New`),
         `NoShow_overThirty` = (`NoShow_overThirty_Established` + `NoShow_overThirty_New`),
         SameDayCanceled = (SameDayCanceled_Established + SameDayCanceled_New),
         `SameDayCanceled_sameDay` = (`SameDayCanceled_sameDay_Established` + `SameDayCanceled_sameDay_New`),
         `SameDayCanceled_belowFourteen` = (`SameDayCanceled_belowFourteen_Established` + `SameDayCanceled_belowFourteen_New`),
         `SameDayCanceled_belowThirty` = (`SameDayCanceled_belowThirty_Established` + `SameDayCanceled_belowThirty_New`),
         `SameDayCanceled_overThirty` = (`SameDayCanceled_overThirty_Established` + `SameDayCanceled_overThirty_New`),
         noShow_rate = round((`NoShow_Established` + `SameDayCanceled_Established` + `NoShow_New` + `SameDayCanceled_New`)/Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/`Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/`Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/`Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/`Total_overThirty`,3),
         new_perc = round(Arrived_New/Arrived,3)) %>%
  group_by(Campus) %>%
  mutate(arrived_site = sum(Arrived),
         arrived_perc = round(Arrived/arrived_site,3)) 


no_show_last_mshs <- no_show_specialty %>%
  filter(Appt.Year == last_year) %>%
  group_by(Campus.Specialty.Group, New.PT2) %>%
  summarise(Arrived = sum(Arrived),
            `Arrived_sameDay` = sum(`Arrived_sameDay`),
            `Arrived_belowFourteen` = sum(`Arrived_belowFourteen`),
            `Arrived_belowThirty` = sum(`Arrived_belowThirty`),
            `Arrived_overThirty` = sum(`Arrived_overThirty`),
            `NoShow` = sum(`NoShow`),
            `NoShow_sameDay` = sum(`NoShow_sameDay`),
            `NoShow_belowFourteen` = sum(`NoShow_belowFourteen`),
            `NoShow_belowThirty` = sum(`NoShow_belowThirty`),
            `NoShow_overThirty` = sum(`NoShow_overThirty`),
            `SameDayCanceled` = sum(`SameDayCanceled`),
            `SameDayCanceled_sameDay` = sum(`SameDayCanceled_sameDay`),
            `SameDayCanceled_belowFourteen` = sum(`SameDayCanceled_belowFourteen`),
            `SameDayCanceled_belowThirty` = sum(`SameDayCanceled_belowThirty`),
            `SameDayCanceled_overThirty` = sum(`SameDayCanceled_overThirty`),
            Total = sum(Total),
            `Total_sameDay` = sum(`Total_sameDay`),
            `Total_belowFourteen` = sum(`Total_belowFourteen`),
            `Total_belowThirty` = sum(`Total_belowThirty`),
            `Total_overThirty` = sum(`Total_overThirty`)) %>%
  mutate(noShow_rate = round((`NoShow` + `SameDayCanceled`)/ Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/ `Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/ `Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/ `Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/ `Total_overThirty`,3)) %>%
  pivot_wider(names_from = New.PT2,
              values_from = 3:27,
              values_fill = 0) %>%
  mutate(Total = (Total_Established + Total_New),
         `Total_sameDay` = (`Total_sameDay_Established` + `Total_sameDay_New`),
         `Total_belowFourteen` = (`Total_belowFourteen_Established` + `Total_belowFourteen_New`),
         `Total_belowThirty` = (`Total_belowThirty_Established` + `Total_belowThirty_New`),
         `Total_overThirty` = (`Total_overThirty_Established` + `Total_overThirty_New`),
         Arrived = (Arrived_Established + Arrived_New),
         `Arrived_sameDay` = (`Arrived_sameDay_Established` + `Arrived_sameDay_New`),
         `Arrived_belowFourteen` = (`Arrived_belowFourteen_Established` + `Arrived_belowFourteen_New`),
         `Arrived_belowThirty` = (`Arrived_belowThirty_Established` + `Arrived_belowThirty_New`),
         `Arrived_overThirty` = (`Arrived_overThirty_Established` + `Arrived_overThirty_New`),
         NoShow = (NoShow_Established + NoShow_New),
         `NoShow_sameDay` = (`NoShow_sameDay_Established` + `NoShow_sameDay_New`),
         `NoShow_belowFourteen` = (`NoShow_belowFourteen_Established` + `NoShow_belowFourteen_New`),
         `NoShow_belowThirty` = (`NoShow_belowThirty_Established` + `NoShow_belowThirty_New`),
         `NoShow_overThirty` = (`NoShow_overThirty_Established` + `NoShow_overThirty_New`),
         SameDayCanceled = (SameDayCanceled_Established + SameDayCanceled_New),
         `SameDayCanceled_sameDay` = (`SameDayCanceled_sameDay_Established` + `SameDayCanceled_sameDay_New`),
         `SameDayCanceled_belowFourteen` = (`SameDayCanceled_belowFourteen_Established` + `SameDayCanceled_belowFourteen_New`),
         `SameDayCanceled_belowThirty` = (`SameDayCanceled_belowThirty_Established` + `SameDayCanceled_belowThirty_New`),
         `SameDayCanceled_overThirty` = (`SameDayCanceled_overThirty_Established` + `SameDayCanceled_overThirty_New`),
         noShow_rate = round((`NoShow_Established` + `SameDayCanceled_Established` + `NoShow_New` + `SameDayCanceled_New`)/Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/`Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/`Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/`Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/`Total_overThirty`,3),
         new_perc = round(Arrived_New/Arrived,3)) %>%
  mutate(Campus = "MSHS Total") %>%
  group_by(Campus) %>%
  mutate(arrived_site = sum(Arrived),
         arrived_perc = round(Arrived/arrived_site,3)) 


no_show_last_merged <- bind_rows(no_show_last_site, no_show_last_mshs)

no_show_last_merged <- no_show_last_merged %>%
  dplyr::select(1:2, 58, 78, 80, 
                3:57, 59:77, 79)



# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('mshs_last_noshow-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_last_merged,
  elementId = "mshs_last_noshow-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,
  
  rowStyle = function(index) {
            if (index %in% c(10)) {
              list(`border-top` = "2px solid rgb(184,184,184)",
                   fontWeight = "Bold")
            }
          },

  groupBy = c("Campus","Campus.Specialty.Group"),

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(last_year, " Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus = colDef(
      # footer = "Total",
      name = "Site",
      minWidth = 220),

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    # Appt.Source.New = colDef(
    #   name = "Source",
    #   minWidth = 100),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)

```
<br/>
<br/>
<br/>


<span style='font-size: 20px; color: #212070'>**No Show Rate by Site**</span><br/>
```{r MSHS No Show Original Last Year Output, echo = FALSE, warning = FALSE, message = FALSE}

no_show_org_last_site <- no_show_org_specialty %>%
  filter(Appt.Year == last_year) %>%
  group_by(Campus, Campus.Specialty.Group, New.PT2) %>%
  summarise(Arrived = sum(Arrived),
            `Arrived_sameDay` = sum(`Arrived_sameDay`),
            `Arrived_belowFourteen` = sum(`Arrived_belowFourteen`),
            `Arrived_belowThirty` = sum(`Arrived_belowThirty`),
            `Arrived_overThirty` = sum(`Arrived_overThirty`),
            `NoShow` = sum(`NoShow`),
            `NoShow_sameDay` = sum(`NoShow_sameDay`),
            `NoShow_belowFourteen` = sum(`NoShow_belowFourteen`),
            `NoShow_belowThirty` = sum(`NoShow_belowThirty`),
            `NoShow_overThirty` = sum(`NoShow_overThirty`),
            Total = sum(Total),
            `Total_sameDay` = sum(`Total_sameDay`),
            `Total_belowFourteen` = sum(`Total_belowFourteen`),
            `Total_belowThirty` = sum(`Total_belowThirty`),
            `Total_overThirty` = sum(`Total_overThirty`)) %>%
  mutate(noShow_rate = round((`NoShow`)/ Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay`)/ `Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen`)/ `Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty`)/ `Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty`)/ `Total_overThirty`,3)) %>%
  pivot_wider(names_from = New.PT2,
              values_from = 4:23,
              values_fill = 0) %>%
  mutate(Total = (Total_Established + Total_New),
         `Total_sameDay` = (`Total_sameDay_Established` + `Total_sameDay_New`),
         `Total_belowFourteen` = (`Total_belowFourteen_Established` + `Total_belowFourteen_New`),
         `Total_belowThirty` = (`Total_belowThirty_Established` + `Total_belowThirty_New`),
         `Total_overThirty` = (`Total_overThirty_Established` + `Total_overThirty_New`),
         Arrived = (Arrived_Established + Arrived_New),
         `Arrived_sameDay` = (`Arrived_sameDay_Established` + `Arrived_sameDay_New`),
         `Arrived_belowFourteen` = (`Arrived_belowFourteen_Established` + `Arrived_belowFourteen_New`),
         `Arrived_belowThirty` = (`Arrived_belowThirty_Established` + `Arrived_belowThirty_New`),
         `Arrived_overThirty` = (`Arrived_overThirty_Established` + `Arrived_overThirty_New`),
         NoShow = (NoShow_Established + NoShow_New),
         `NoShow_sameDay` = (`NoShow_sameDay_Established` + `NoShow_sameDay_New`),
         `NoShow_belowFourteen` = (`NoShow_belowFourteen_Established` + `NoShow_belowFourteen_New`),
         `NoShow_belowThirty` = (`NoShow_belowThirty_Established` + `NoShow_belowThirty_New`),
         `NoShow_overThirty` = (`NoShow_overThirty_Established` + `NoShow_overThirty_New`),
         noShow_rate = round((`NoShow_Established` + `NoShow_New`)/Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay`)/`Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen`)/`Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty`)/`Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty`)/`Total_overThirty`,3),
         new_perc = round(Arrived_New/Arrived,3)) %>%
  group_by(Campus) %>%
  mutate(arrived_site = sum(Arrived),
         arrived_perc = round(Arrived/arrived_site,3)) 


no_show_org_last_mshs <- no_show_org_specialty %>%
  filter(Appt.Year == last_year) %>%
  group_by(Campus.Specialty.Group, New.PT2) %>%
  summarise(Arrived = sum(Arrived),
            `Arrived_sameDay` = sum(`Arrived_sameDay`),
            `Arrived_belowFourteen` = sum(`Arrived_belowFourteen`),
            `Arrived_belowThirty` = sum(`Arrived_belowThirty`),
            `Arrived_overThirty` = sum(`Arrived_overThirty`),
            `NoShow` = sum(`NoShow`),
            `NoShow_sameDay` = sum(`NoShow_sameDay`),
            `NoShow_belowFourteen` = sum(`NoShow_belowFourteen`),
            `NoShow_belowThirty` = sum(`NoShow_belowThirty`),
            `NoShow_overThirty` = sum(`NoShow_overThirty`),
            Total = sum(Total),
            `Total_sameDay` = sum(`Total_sameDay`),
            `Total_belowFourteen` = sum(`Total_belowFourteen`),
            `Total_belowThirty` = sum(`Total_belowThirty`),
            `Total_overThirty` = sum(`Total_overThirty`)) %>%
  mutate(noShow_rate = round((`NoShow`)/ Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay`)/ `Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen`)/ `Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty`)/ `Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty`)/ `Total_overThirty`,3)) %>%
  pivot_wider(names_from = New.PT2,
              values_from = 3:22,
              values_fill = 0) %>%
  mutate(Total = (Total_Established + Total_New),
         `Total_sameDay` = (`Total_sameDay_Established` + `Total_sameDay_New`),
         `Total_belowFourteen` = (`Total_belowFourteen_Established` + `Total_belowFourteen_New`),
         `Total_belowThirty` = (`Total_belowThirty_Established` + `Total_belowThirty_New`),
         `Total_overThirty` = (`Total_overThirty_Established` + `Total_overThirty_New`),
         Arrived = (Arrived_Established + Arrived_New),
         `Arrived_sameDay` = (`Arrived_sameDay_Established` + `Arrived_sameDay_New`),
         `Arrived_belowFourteen` = (`Arrived_belowFourteen_Established` + `Arrived_belowFourteen_New`),
         `Arrived_belowThirty` = (`Arrived_belowThirty_Established` + `Arrived_belowThirty_New`),
         `Arrived_overThirty` = (`Arrived_overThirty_Established` + `Arrived_overThirty_New`),
         NoShow = (NoShow_Established + NoShow_New),
         `NoShow_sameDay` = (`NoShow_sameDay_Established` + `NoShow_sameDay_New`),
         `NoShow_belowFourteen` = (`NoShow_belowFourteen_Established` + `NoShow_belowFourteen_New`),
         `NoShow_belowThirty` = (`NoShow_belowThirty_Established` + `NoShow_belowThirty_New`),
         `NoShow_overThirty` = (`NoShow_overThirty_Established` + `NoShow_overThirty_New`),
         noShow_rate = round((`NoShow_Established` + `NoShow_New`)/Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay`)/`Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen`)/`Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty`)/`Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty`)/`Total_overThirty`,3),
         new_perc = round(Arrived_New/Arrived,3)) %>%
  mutate(Campus = "MSHS Total") %>%
  group_by(Campus) %>%
  mutate(arrived_site = sum(Arrived),
         arrived_perc = round(Arrived/arrived_site,3)) 


no_show_org_last_merged <- bind_rows(no_show_org_last_site, no_show_org_last_mshs)

no_show_org_last_merged <- no_show_org_last_merged %>%
  dplyr::select(1:2, 48, 63, 65, 
                3:47, 49:62, 64)



# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('mshs_last_noshow_org-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_org_last_merged,
  elementId = "mshs_last_noshow_org-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
   height = 700,
    wrap = TRUE,
  searchable = TRUE,
  
  rowStyle = function(index) {
            if (index %in% c(10)) {
              list(`border-top` = "2px solid rgb(184,184,184)",
                   fontWeight = "Bold")
            }
          },

  groupBy = c("Campus","Campus.Specialty.Group"),

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(last_year, " Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus = colDef(
      # footer = "Total",
      name = "Site",
      minWidth = 220),

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    # Appt.Source.New = colDef(
    #   name = "Source",
    #   minWidth = 100),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalTotal += row['Total']
        })
        return (totalNoShow) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)

```
<br/>
<br/>
<br/>


<span style='font-size: 20px; color: #212070'>**No Show Rate (All Statuses) by Site**</span><br/>
```{r MSHS No Show All Statuses Last Year Output, echo = FALSE, warning = FALSE, message = FALSE}

no_show_all_last_site <- no_show_all_specialty %>%
  filter(Appt.Year == last_year) %>%
  group_by(Campus, Campus.Specialty.Group, New.PT2) %>%
  summarise(Arrived = sum(Arrived),
            `Arrived_sameDay` = sum(`Arrived_sameDay`),
            `Arrived_belowFourteen` = sum(`Arrived_belowFourteen`),
            `Arrived_belowThirty` = sum(`Arrived_belowThirty`),
            `Arrived_overThirty` = sum(`Arrived_overThirty`),
            `NoShow` = sum(`NoShow`),
            `NoShow_sameDay` = sum(`NoShow_sameDay`),
            `NoShow_belowFourteen` = sum(`NoShow_belowFourteen`),
            `NoShow_belowThirty` = sum(`NoShow_belowThirty`),
            `NoShow_overThirty` = sum(`NoShow_overThirty`),
            `SameDayCanceled` = sum(`SameDayCanceled`),
            `SameDayCanceled_sameDay` = sum(`SameDayCanceled_sameDay`),
            `SameDayCanceled_belowFourteen` = sum(`SameDayCanceled_belowFourteen`),
            `SameDayCanceled_belowThirty` = sum(`SameDayCanceled_belowThirty`),
            `SameDayCanceled_overThirty` = sum(`SameDayCanceled_overThirty`),
            Total = sum(Total),
            `Total_sameDay` = sum(`Total_sameDay`),
            `Total_belowFourteen` = sum(`Total_belowFourteen`),
            `Total_belowThirty` = sum(`Total_belowThirty`),
            `Total_overThirty` = sum(`Total_overThirty`)) %>%
  mutate(noShow_rate = round((`NoShow`)/ Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay`)/ `Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen`)/ `Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty`)/ `Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty`)/ `Total_overThirty`,3)) %>%
  pivot_wider(names_from = New.PT2,
              values_from = 4:28,
              values_fill = 0) %>%
  mutate(Total = (Total_Established + Total_New),
         `Total_sameDay` = (`Total_sameDay_Established` + `Total_sameDay_New`),
         `Total_belowFourteen` = (`Total_belowFourteen_Established` + `Total_belowFourteen_New`),
         `Total_belowThirty` = (`Total_belowThirty_Established` + `Total_belowThirty_New`),
         `Total_overThirty` = (`Total_overThirty_Established` + `Total_overThirty_New`),
         Arrived = (Arrived_Established + Arrived_New),
         `Arrived_sameDay` = (`Arrived_sameDay_Established` + `Arrived_sameDay_New`),
         `Arrived_belowFourteen` = (`Arrived_belowFourteen_Established` + `Arrived_belowFourteen_New`),
         `Arrived_belowThirty` = (`Arrived_belowThirty_Established` + `Arrived_belowThirty_New`),
         `Arrived_overThirty` = (`Arrived_overThirty_Established` + `Arrived_overThirty_New`),
         NoShow = (NoShow_Established + NoShow_New),
         `NoShow_sameDay` = (`NoShow_sameDay_Established` + `NoShow_sameDay_New`),
         `NoShow_belowFourteen` = (`NoShow_belowFourteen_Established` + `NoShow_belowFourteen_New`),
         `NoShow_belowThirty` = (`NoShow_belowThirty_Established` + `NoShow_belowThirty_New`),
         `NoShow_overThirty` = (`NoShow_overThirty_Established` + `NoShow_overThirty_New`),
         SameDayCanceled = (SameDayCanceled_Established + SameDayCanceled_New),
         `SameDayCanceled_sameDay` = (`SameDayCanceled_sameDay_Established` + `SameDayCanceled_sameDay_New`),
         `SameDayCanceled_belowFourteen` = (`SameDayCanceled_belowFourteen_Established` + `SameDayCanceled_belowFourteen_New`),
         `SameDayCanceled_belowThirty` = (`SameDayCanceled_belowThirty_Established` + `SameDayCanceled_belowThirty_New`),
         `SameDayCanceled_overThirty` = (`SameDayCanceled_overThirty_Established` + `SameDayCanceled_overThirty_New`),
         noShow_rate = round((`NoShow_Established` + `NoShow_New`)/Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay`)/`Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen`)/`Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty`)/`Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty`)/`Total_overThirty`,3),
         new_perc = round(Arrived_New/Arrived,3)) %>%
  group_by(Campus) %>%
  mutate(arrived_site = sum(Arrived),
         arrived_perc = round(Arrived/arrived_site,3)) 


no_show_all_last_mshs <- no_show_all_specialty %>%
  filter(Appt.Year == last_year) %>%
  group_by(Campus.Specialty.Group, New.PT2) %>%
  summarise(Arrived = sum(Arrived),
            `Arrived_sameDay` = sum(`Arrived_sameDay`),
            `Arrived_belowFourteen` = sum(`Arrived_belowFourteen`),
            `Arrived_belowThirty` = sum(`Arrived_belowThirty`),
            `Arrived_overThirty` = sum(`Arrived_overThirty`),
            `NoShow` = sum(`NoShow`),
            `NoShow_sameDay` = sum(`NoShow_sameDay`),
            `NoShow_belowFourteen` = sum(`NoShow_belowFourteen`),
            `NoShow_belowThirty` = sum(`NoShow_belowThirty`),
            `NoShow_overThirty` = sum(`NoShow_overThirty`),
            `SameDayCanceled` = sum(`SameDayCanceled`),
            `SameDayCanceled_sameDay` = sum(`SameDayCanceled_sameDay`),
            `SameDayCanceled_belowFourteen` = sum(`SameDayCanceled_belowFourteen`),
            `SameDayCanceled_belowThirty` = sum(`SameDayCanceled_belowThirty`),
            `SameDayCanceled_overThirty` = sum(`SameDayCanceled_overThirty`),
            Total = sum(Total),
            `Total_sameDay` = sum(`Total_sameDay`),
            `Total_belowFourteen` = sum(`Total_belowFourteen`),
            `Total_belowThirty` = sum(`Total_belowThirty`),
            `Total_overThirty` = sum(`Total_overThirty`)) %>%
  mutate(noShow_rate = round((`NoShow`)/ Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay`)/ `Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen`)/ `Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty`)/ `Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty`)/ `Total_overThirty`,3)) %>%
  pivot_wider(names_from = New.PT2,
              values_from = 3:27,
              values_fill = 0) %>%
  mutate(Total = (Total_Established + Total_New),
         `Total_sameDay` = (`Total_sameDay_Established` + `Total_sameDay_New`),
         `Total_belowFourteen` = (`Total_belowFourteen_Established` + `Total_belowFourteen_New`),
         `Total_belowThirty` = (`Total_belowThirty_Established` + `Total_belowThirty_New`),
         `Total_overThirty` = (`Total_overThirty_Established` + `Total_overThirty_New`),
         Arrived = (Arrived_Established + Arrived_New),
         `Arrived_sameDay` = (`Arrived_sameDay_Established` + `Arrived_sameDay_New`),
         `Arrived_belowFourteen` = (`Arrived_belowFourteen_Established` + `Arrived_belowFourteen_New`),
         `Arrived_belowThirty` = (`Arrived_belowThirty_Established` + `Arrived_belowThirty_New`),
         `Arrived_overThirty` = (`Arrived_overThirty_Established` + `Arrived_overThirty_New`),
         NoShow = (NoShow_Established + NoShow_New),
         `NoShow_sameDay` = (`NoShow_sameDay_Established` + `NoShow_sameDay_New`),
         `NoShow_belowFourteen` = (`NoShow_belowFourteen_Established` + `NoShow_belowFourteen_New`),
         `NoShow_belowThirty` = (`NoShow_belowThirty_Established` + `NoShow_belowThirty_New`),
         `NoShow_overThirty` = (`NoShow_overThirty_Established` + `NoShow_overThirty_New`),
         SameDayCanceled = (SameDayCanceled_Established + SameDayCanceled_New),
         `SameDayCanceled_sameDay` = (`SameDayCanceled_sameDay_Established` + `SameDayCanceled_sameDay_New`),
         `SameDayCanceled_belowFourteen` = (`SameDayCanceled_belowFourteen_Established` + `SameDayCanceled_belowFourteen_New`),
         `SameDayCanceled_belowThirty` = (`SameDayCanceled_belowThirty_Established` + `SameDayCanceled_belowThirty_New`),
         `SameDayCanceled_overThirty` = (`SameDayCanceled_overThirty_Established` + `SameDayCanceled_overThirty_New`),
         noShow_rate = round((`NoShow_Established` + `NoShow_New`)/Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay`)/`Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen`)/`Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty`)/`Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty`)/`Total_overThirty`,3),
         new_perc = round(Arrived_New/Arrived,3)) %>%
  mutate(Campus = "MSHS Total") %>%
  group_by(Campus) %>%
  group_by(Campus) %>%
  mutate(arrived_site = sum(Arrived),
         arrived_perc = round(Arrived/arrived_site,3))


no_show_all_last_merged <- bind_rows(no_show_all_last_site, no_show_all_last_mshs)

no_show_all_last_merged <- no_show_all_last_merged %>%
  dplyr::select(1:2, 58, 78, 80, 
                3:57, 59:77, 79)



# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('mshs_last_noshow_all-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_all_last_merged,
  elementId = "mshs_last_noshow_all-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
   height = 700,
    wrap = TRUE,
  searchable = TRUE,
  
  rowStyle = function(index) {
            if (index %in% c(10)) {
              list(`border-top` = "2px solid rgb(184,184,184)",
                   fontWeight = "Bold")
            }
          },

  groupBy = c("Campus","Campus.Specialty.Group"),

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(last_year, " Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Rate (All Statuses) - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Rate (All Statuses) - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Rate (All Statuses) - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus = colDef(
      # footer = "Total",
      name = "Site",
      minWidth = 220),

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    # Appt.Source.New = colDef(
    #   name = "Source",
    #   minWidth = 100),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalTotal += row['Total']
        })
        return (totalNoShow) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)

```
<br/>
<br/>
<br/>


<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r MSHS No Show by Specialty Last Year Output, echo = FALSE, warning = FALSE, message = FALSE}

no_show_last_specialty <- no_show_specialty %>%
  filter(Appt.Year == last_year) %>%
    group_by(Campus.Specialty.Group, Campus, New.PT2) %>%
  summarise(Arrived = sum(Arrived),
            `Arrived_sameDay` = sum(`Arrived_sameDay`),
            `Arrived_belowFourteen` = sum(`Arrived_belowFourteen`),
            `Arrived_belowThirty` = sum(`Arrived_belowThirty`),
            `Arrived_overThirty` = sum(`Arrived_overThirty`),
            `NoShow` = sum(`NoShow`),
            `NoShow_sameDay` = sum(`NoShow_sameDay`),
            `NoShow_belowFourteen` = sum(`NoShow_belowFourteen`),
            `NoShow_belowThirty` = sum(`NoShow_belowThirty`),
            `NoShow_overThirty` = sum(`NoShow_overThirty`),
            `SameDayCanceled` = sum(`SameDayCanceled`),
            `SameDayCanceled_sameDay` = sum(`SameDayCanceled_sameDay`),
            `SameDayCanceled_belowFourteen` = sum(`SameDayCanceled_belowFourteen`),
            `SameDayCanceled_belowThirty` = sum(`SameDayCanceled_belowThirty`),
            `SameDayCanceled_overThirty` = sum(`SameDayCanceled_overThirty`),
            Total = sum(Total),
            `Total_sameDay` = sum(`Total_sameDay`),
            `Total_belowFourteen` = sum(`Total_belowFourteen`),
            `Total_belowThirty` = sum(`Total_belowThirty`),
            `Total_overThirty` = sum(`Total_overThirty`)) %>%
  mutate(noShow_rate = round((`NoShow` + `SameDayCanceled`)/ Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/ `Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/ `Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/ `Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/ `Total_overThirty`,3)) %>%
  pivot_wider(names_from = New.PT2,
              values_from = 4:28,
              values_fill = 0) %>%
  mutate(Total = (Total_Established + Total_New),
         `Total_sameDay` = (`Total_sameDay_Established` + `Total_sameDay_New`),
         `Total_belowFourteen` = (`Total_belowFourteen_Established` + `Total_belowFourteen_New`),
         `Total_belowThirty` = (`Total_belowThirty_Established` + `Total_belowThirty_New`),
         `Total_overThirty` = (`Total_overThirty_Established` + `Total_overThirty_New`),
         Arrived = (Arrived_Established + Arrived_New),
         `Arrived_sameDay` = (`Arrived_sameDay_Established` + `Arrived_sameDay_New`),
         `Arrived_belowFourteen` = (`Arrived_belowFourteen_Established` + `Arrived_belowFourteen_New`),
         `Arrived_belowThirty` = (`Arrived_belowThirty_Established` + `Arrived_belowThirty_New`),
         `Arrived_overThirty` = (`Arrived_overThirty_Established` + `Arrived_overThirty_New`),
         NoShow = (NoShow_Established + NoShow_New),
         `NoShow_sameDay` = (`NoShow_sameDay_Established` + `NoShow_sameDay_New`),
         `NoShow_belowFourteen` = (`NoShow_belowFourteen_Established` + `NoShow_belowFourteen_New`),
         `NoShow_belowThirty` = (`NoShow_belowThirty_Established` + `NoShow_belowThirty_New`),
         `NoShow_overThirty` = (`NoShow_overThirty_Established` + `NoShow_overThirty_New`),
         SameDayCanceled = (SameDayCanceled_Established + SameDayCanceled_New),
         `SameDayCanceled_sameDay` = (`SameDayCanceled_sameDay_Established` + `SameDayCanceled_sameDay_New`),
         `SameDayCanceled_belowFourteen` = (`SameDayCanceled_belowFourteen_Established` + `SameDayCanceled_belowFourteen_New`),
         `SameDayCanceled_belowThirty` = (`SameDayCanceled_belowThirty_Established` + `SameDayCanceled_belowThirty_New`),
         `SameDayCanceled_overThirty` = (`SameDayCanceled_overThirty_Established` + `SameDayCanceled_overThirty_New`),
         noShow_rate = round((`NoShow_Established` + `SameDayCanceled_Established` + `NoShow_New` + `SameDayCanceled_New`)/Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/`Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/`Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/`Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/`Total_overThirty`,3),
         new_perc = round(Arrived_New/Arrived,3)) %>%
  group_by(Campus.Specialty.Group) %>%
  mutate(arrived_site = sum(Arrived),
         arrived_perc = round(Arrived/arrived_site,3)) 

no_show_last_specialty <- no_show_last_specialty %>%
  dplyr::select(1:2, 58, 78, 80, 
                3:57, 59:77, 79)



# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('mshs_last_noshow_specialty-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_ytd_specialty,
  elementId = "mshs_last_noshow_specialty-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,
  
  # rowStyle = function(index) {
  #           if (index %in% c(10)) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },

  groupBy = c("Campus.Specialty.Group"),

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(last_year, " Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Campus = colDef(
      name = "Site",
      minWidth = 200),
    
    # Appt.Source.New = colDef(
    #   name = "Source",
    #   minWidth = 100),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Specialty Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)
```
<br/>
<br/>
<br/>


<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Group**</span><br/>
```{r MSHS No Show by Group Last Year Output, echo = FALSE, warning = FALSE, message = FALSE}

no_show_last_specialty_group <- no_show_specialty %>%
  filter(Appt.Year == last_year) %>%
    group_by(Campus.Specialty.Group, Campus, Appt.Source.New, New.PT2) %>%
  summarise(Arrived = sum(Arrived),
            `Arrived_sameDay` = sum(`Arrived_sameDay`),
            `Arrived_belowFourteen` = sum(`Arrived_belowFourteen`),
            `Arrived_belowThirty` = sum(`Arrived_belowThirty`),
            `Arrived_overThirty` = sum(`Arrived_overThirty`),
            `NoShow` = sum(`NoShow`),
            `NoShow_sameDay` = sum(`NoShow_sameDay`),
            `NoShow_belowFourteen` = sum(`NoShow_belowFourteen`),
            `NoShow_belowThirty` = sum(`NoShow_belowThirty`),
            `NoShow_overThirty` = sum(`NoShow_overThirty`),
            `SameDayCanceled` = sum(`SameDayCanceled`),
            `SameDayCanceled_sameDay` = sum(`SameDayCanceled_sameDay`),
            `SameDayCanceled_belowFourteen` = sum(`SameDayCanceled_belowFourteen`),
            `SameDayCanceled_belowThirty` = sum(`SameDayCanceled_belowThirty`),
            `SameDayCanceled_overThirty` = sum(`SameDayCanceled_overThirty`),
            Total = sum(Total),
            `Total_sameDay` = sum(`Total_sameDay`),
            `Total_belowFourteen` = sum(`Total_belowFourteen`),
            `Total_belowThirty` = sum(`Total_belowThirty`),
            `Total_overThirty` = sum(`Total_overThirty`)) %>%
  mutate(noShow_rate = round((`NoShow` + `SameDayCanceled`)/ Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/ `Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/ `Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/ `Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/ `Total_overThirty`,3)) %>%
  pivot_wider(names_from = New.PT2,
              values_from = 5:29,
              values_fill = 0) %>%
  mutate(Total = (Total_Established + Total_New),
         `Total_sameDay` = (`Total_sameDay_Established` + `Total_sameDay_New`),
         `Total_belowFourteen` = (`Total_belowFourteen_Established` + `Total_belowFourteen_New`),
         `Total_belowThirty` = (`Total_belowThirty_Established` + `Total_belowThirty_New`),
         `Total_overThirty` = (`Total_overThirty_Established` + `Total_overThirty_New`),
         Arrived = (Arrived_Established + Arrived_New),
         `Arrived_sameDay` = (`Arrived_sameDay_Established` + `Arrived_sameDay_New`),
         `Arrived_belowFourteen` = (`Arrived_belowFourteen_Established` + `Arrived_belowFourteen_New`),
         `Arrived_belowThirty` = (`Arrived_belowThirty_Established` + `Arrived_belowThirty_New`),
         `Arrived_overThirty` = (`Arrived_overThirty_Established` + `Arrived_overThirty_New`),
         NoShow = (NoShow_Established + NoShow_New),
         `NoShow_sameDay` = (`NoShow_sameDay_Established` + `NoShow_sameDay_New`),
         `NoShow_belowFourteen` = (`NoShow_belowFourteen_Established` + `NoShow_belowFourteen_New`),
         `NoShow_belowThirty` = (`NoShow_belowThirty_Established` + `NoShow_belowThirty_New`),
         `NoShow_overThirty` = (`NoShow_overThirty_Established` + `NoShow_overThirty_New`),
         SameDayCanceled = (SameDayCanceled_Established + SameDayCanceled_New),
         `SameDayCanceled_sameDay` = (`SameDayCanceled_sameDay_Established` + `SameDayCanceled_sameDay_New`),
         `SameDayCanceled_belowFourteen` = (`SameDayCanceled_belowFourteen_Established` + `SameDayCanceled_belowFourteen_New`),
         `SameDayCanceled_belowThirty` = (`SameDayCanceled_belowThirty_Established` + `SameDayCanceled_belowThirty_New`),
         `SameDayCanceled_overThirty` = (`SameDayCanceled_overThirty_Established` + `SameDayCanceled_overThirty_New`),
         noShow_rate = round((`NoShow_Established` + `SameDayCanceled_Established` + `NoShow_New` + `SameDayCanceled_New`)/Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/`Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/`Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/`Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/`Total_overThirty`,3),
         new_perc = round(Arrived_New/Arrived,3)) %>%
  group_by(Campus.Specialty.Group, Campus) %>%
  mutate(arrived_site = sum(Arrived),
         arrived_perc = round(Arrived/arrived_site,3)) 

no_show_last_specialty_group <- no_show_last_specialty_group %>%
  dplyr::select(1:3, 59, 79, 81, 
                4:58, 60:78, 80)


# Table Output -----------------------------------------------------------------
# htmltools::browsable(
#   tagList(
#     tags$button(
#       tagList(fontawesome::fa("download"), "Download Table"),
#       onclick = "Reactable.downloadDataCSV('mshs_ytd_noshow_group-download-table', 'Avg No Show Rate')"
#     ),

htmltools::browsable(
  tagList(
    div(tags$label("Group by", `for` = "mshs_last_noshow_group-select")),
    tags$select(
      id = "mshs_last_noshow_group-select",
      onchange = "Reactable.setGroupBy('mshs_last_noshow_group-table', this.value ? [this.value] : [])",
      tags$option("None", value = c("Campus","Campus.Specialty.Group","Appt.Source.New")),
      # tags$option("Test", value = c("Appt.Source.New","Campus.Specialty.Group")),
      # lapply(c("Campus", "Campus.Specialty.Group", "Appt.Source.New"), tags$option)
      lapply(c("Campus", "Campus.Specialty.Group", "Appt.Source.New"), tags$option)
    ),

    tags$hr("aria-hidden" = "true"),

reactable(
  no_show_last_specialty_group,
  # elementId = "mshs_ytd_noshow_group-download-table",
  elementId = "mshs_last_noshow_group-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,
  
  # rowStyle = function(index) {
  #           if (index %in% c(10)) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },

  groupBy = c("Campus.Specialty.Group","Campus"),

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Appt.Source.New"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(last_year, " Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Campus = colDef(
      name = "Site",
      minWidth = 150),
    
    Appt.Source.New = colDef(
      name = "Appt Source",
      minWidth = 100),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)

```
<br/>
<br/>
<br/>


#### Trend
<span style='font-size: 20px; color: #212070'>**MSHS No Show Plus Rate Trend**</span><br/>
```{r MSHS No Show Trend, echo = FALSE, warning = FALSE, message = FALSE}

no_show_trend_mshs_all <- no_show_specialty %>%
  mutate(Campus = "MSHS") %>%
  group_by(Campus, Appt.MonthYear, New.PT2) %>%
  summarise(Arrived = sum(Arrived),
            `NoShow` = sum(`NoShow`),
            `SameDayCanceled` = sum(`SameDayCanceled`),
            Total = sum(Total)) %>%
  mutate(noShow_rate = round((`NoShow` + `SameDayCanceled`)/ Total,3)*100) %>%
  pivot_wider(names_from = New.PT2,
              values_from = 4:8,
              values_fill = 0) %>%
  mutate(Total = (Total_Established + Total_New),
         noShow_rate = round((`NoShow_Established` + `SameDayCanceled_Established` + `NoShow_New` + `SameDayCanceled_New`)/Total,3)*100,
         new_perc = round(Total_New/Total,3)*100)


map(unique(no_show_trend_mshs_all$Campus), function(x){
highchart() %>%
  hc_yAxis_multiples(
    # list(title = list(text = "Avg Volume per Day"), lineWidth = 3),
    list(title = list(text = "No Show Plus Rate"), lineWidth = 3, 
         labels = list(enabled = TRUE, format = '{value}%'),
         plotLines = list(list(value = 20, color = "red", width = 2,
                               dashStyle = "shortdash")))
           # showLastLabel = FALSE, opposite = TRUE)
  ) %>%
  hc_xAxis(title = list(text = ""),
           categories = (no_show_trend_mshs_all %>% filter(Campus == x))$Appt.MonthYear,
           type = "datetime",
           labels = list(enabled = TRUE, format = '{value:%Y-%m}')
           # dateTimeLabelFormats = list(month = '%Y-%m')
           ) %>%
  # hc_add_series(name = "Total Visits",
  #               data = (volume_trend_mshs %>% filter(Campus == x))$avg_vol_all,
  #               type = 'column',
  #               color='#212070',
  #               dataLabels = list(enabled = TRUE, format='{point.y}')) %>%
  hc_add_series(name   = "Established",
                data   = (no_show_trend_mshs_all %>% filter(Campus == x))$noShow_rate_Established,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#212070',
                lineWidth=3,
                lineColor='#212070'
                ) %>%
  hc_add_series(name   = "New",
                data   = (no_show_trend_mshs_all %>% filter(Campus == x))$noShow_rate_New,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#d80b8c',
                lineWidth=3,
                lineColor='#d80b8c'
                ) %>%
  hc_add_series(name   = "All",
                data   = (no_show_trend_mshs_all %>% filter(Campus == x))$noShow_rate,
               type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#7f7f7f',
                lineWidth=3,
                lineColor='#7f7f7f'
                ) %>%
  hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>%
  hc_title(text = paste0(x, " - Avg No Show Plus Rate"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>%
  hc_subtitle(text = "Target:",
              align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>%
    hc_tooltip(shared = TRUE, borderColor = "black", valueSuffix = "%")
    
  }) %>%
  hw_grid(ncol = 1, rowheight = 400) %>% htmltools::browsable()

```
<br/>


<span style='font-size: 20px; color: #212070'>**No Show Plus Rate Trend by Site**</span><br/>
```{r By Site No Show Trend, echo = FALSE, warning = FALSE, message = FALSE}

no_show_trend_mshs <- no_show_specialty %>%
  filter(Appt.Year == current_year) %>%
  group_by(Campus, Appt.MonthYear, New.PT2) %>%
  summarise(Arrived = sum(Arrived),
            `NoShow` = sum(`NoShow`),
            `SameDayCanceled` = sum(`SameDayCanceled`),
            Total = sum(Total)) %>%
  mutate(noShow_rate = round((`NoShow` + `SameDayCanceled`)/ Total,3)*100) %>%
  pivot_wider(names_from = New.PT2,
              values_from = 4:8,
              values_fill = 0) %>%
  mutate(Total = (Total_Established + Total_New),
         noShow_rate = round((`NoShow_Established` + `SameDayCanceled_Established` + `NoShow_New` + `SameDayCanceled_New`)/Total,3)*100,
         new_perc = round(Total_New/Total,3)*100)


map(unique(no_show_trend_mshs$Campus), function(x){
highchart() %>%
  hc_yAxis_multiples(
    # list(title = list(text = "Avg Volume per Day"), lineWidth = 3),
    list(title = list(text = "No Show Plus Rate"), lineWidth = 3, 
         labels = list(format = '{value}%'),
         plotLines = list(list(value = 20, color = "red", width = 2,
                               dashStyle = "shortdash")))
           # showLastLabel = FALSE, opposite = TRUE)
  ) %>%
  hc_xAxis(title = list(text = ""),
           categories = (no_show_trend_mshs %>% filter(Campus == x))$Appt.MonthYear,
           type = "datetime",
           labels = list(format = '{value:%Y-%m}')
           # dateTimeLabelFormats = list(month = '%Y-%m')
           ) %>%
  # hc_add_series(name = "Total Visits",
  #               data = (volume_trend_mshs %>% filter(Campus == x))$avg_vol_all,
  #               type = 'column',
  #               color='#212070',
  #               dataLabels = list(enabled = TRUE, format='{point.y}')) %>%
  hc_add_series(name   = "Established",
                data   = (no_show_trend_mshs %>% filter(Campus == x))$noShow_rate_Established,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#212070',
                lineWidth=3,
                lineColor='#212070'
                ) %>%
  hc_add_series(name   = "New",
                data   = (no_show_trend_mshs %>% filter(Campus == x))$noShow_rate_New,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#d80b8c',
                lineWidth=3,
                lineColor='#d80b8c'
                ) %>%
  hc_add_series(name   = "All",
                data   = (no_show_trend_mshs %>% filter(Campus == x))$noShow_rate,
               type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#7f7f7f',
                lineWidth=3,
                lineColor='#7f7f7f'
                ) %>%
  hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>%
  hc_title(text = paste0(x, " - Avg No Show Plus Rate"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>%
  hc_subtitle(text = "Target:",
              align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>%
    hc_tooltip(shared = TRUE, borderColor = "black", valueSuffix = "%")
  }) %>%
  hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable()

```
<br/>
<br/>
<br/>


```{r Site YTD Volume Function, echo = FALSE, warning = FALSE, message = FALSE}

day_order <- c('Mon','Tue','Wed','Thu','Fri')
site_order <- c("MSBI","MSDMG","MSH- AMBULATORY CARE","MSH-MSDFP","MSM","MSUS","MSW","NETWORK","ONCOLOGY","MSHS Total")

ytd_total_volume_site_function <- function(site){
  
  # site <- "MSBI"
  ytd_site <- arrived_calculation_ytd_site %>%
    filter(Campus == site)
  
  ytd_total_volume_site <- ytd_site %>%
    arrange(match(Appt.Day, day_order)) %>%
    ungroup() %>%
    dplyr::select(Campus, Appt.Day, total_day) %>%
    mutate(Appt.Day = paste0(Appt.Day,"_total_day")) %>%
    pivot_wider(names_from = Appt.Day,
                values_from = total_day) %>%
    mutate(blank = "")
  
  ytd_avg_volume_site <- ytd_site %>%
    arrange(match(Appt.Day, day_order)) %>%
    ungroup() %>%
    dplyr::select(Campus, Appt.Day, avg_vol_day) %>%
    mutate(Appt.Day = paste0(Appt.Day,"_avg_day")) %>%
    pivot_wider(names_from = Appt.Day,
                values_from = avg_vol_day) %>%
    mutate(blank1 = "")

  ytd_avg_var_site <- ytd_site %>%
    arrange(match(Appt.Day, day_order)) %>%
    ungroup() %>%
    dplyr::select(Campus, Appt.Day, daily_var) %>%
    mutate(Appt.Day = paste0(Appt.Day,"_var")) %>%
    pivot_wider(names_from = Appt.Day,
                values_from = daily_var)

  ytd_site_merged <- merge(ytd_total_volume_site, ytd_avg_volume_site)
  ytd_site_merged <- merge(ytd_site_merged, ytd_avg_var_site)
  
}


ytd_total_volume_specialty_function <- function(site){
  
  # site <- "MSBI"
  ytd_specialty <- arrived_calculation_ytd_specialty %>%
    filter(Campus == site)
  
  ytd_total_volume_specialty <- ytd_specialty %>%
    arrange(match(Appt.Day, day_order)) %>%
    ungroup() %>%
    dplyr::select(Campus.Specialty.Group, Appt.Day, total_day) %>%
    mutate(Appt.Day = paste0(Appt.Day,"_total_day")) %>%
    pivot_wider(names_from = Appt.Day,
                values_from = total_day) %>%
    mutate(blank = "")
  
  ytd_avg_volume_specialty <- ytd_specialty %>%
    arrange(match(Appt.Day, day_order)) %>%
    ungroup() %>%
    dplyr::select(Campus.Specialty.Group, Appt.Day, avg_vol_day) %>%
    mutate(Appt.Day = paste0(Appt.Day,"_avg_day")) %>%
    pivot_wider(names_from = Appt.Day,
                values_from = avg_vol_day) %>%
    mutate(blank1 = "")

  ytd_avg_var_specialty <- ytd_specialty %>%
    arrange(match(Appt.Day, day_order)) %>%
    ungroup() %>%
    dplyr::select(Campus.Specialty.Group, Appt.Day, daily_var) %>%
    mutate(Appt.Day = paste0(Appt.Day,"_var")) %>%
    pivot_wider(names_from = Appt.Day,
                values_from = daily_var)

  ytd_specialty_merged <- merge(ytd_total_volume_specialty, ytd_avg_volume_specialty)
  ytd_specialty_merged <- merge(ytd_specialty_merged, ytd_avg_var_specialty)
  
}


```


```{r Site Last Year Volume Function, echo = FALSE, warning = FALSE, message = FALSE}

day_order <- c('Mon','Tue','Wed','Thu','Fri')
site_order <- c("MSBI","MSDMG","MSH- AMBULATORY CARE","MSH-MSDFP","MSM","MSUS","MSW","NETWORK","ONCOLOGY","MSHS Total")

last_total_volume_site_function <- function(site){
  
  # site <- "MSBI"
  last_site <- arrived_calculation_last_site %>%
    filter(Campus == site)
  
  last_total_volume_site <- last_site %>%
    arrange(match(Appt.Day, day_order)) %>%
    ungroup() %>%
    dplyr::select(Campus, Appt.Day, total_day) %>%
    mutate(Appt.Day = paste0(Appt.Day,"_total_day")) %>%
    pivot_wider(names_from = Appt.Day,
                values_from = total_day) %>%
    mutate(blank = "")
  
  last_avg_volume_site <- last_site %>%
    arrange(match(Appt.Day, day_order)) %>%
    ungroup() %>%
    dplyr::select(Campus, Appt.Day, avg_vol_day) %>%
    mutate(Appt.Day = paste0(Appt.Day,"_avg_day")) %>%
    pivot_wider(names_from = Appt.Day,
                values_from = avg_vol_day) %>%
    mutate(blank1 = "")

  last_avg_var_site <- last_site %>%
    arrange(match(Appt.Day, day_order)) %>%
    ungroup() %>%
    dplyr::select(Campus, Appt.Day, daily_var) %>%
    mutate(Appt.Day = paste0(Appt.Day,"_var")) %>%
    pivot_wider(names_from = Appt.Day,
                values_from = daily_var)

  last_site_merged <- merge(last_total_volume_site, last_avg_volume_site)
  last_site_merged <- merge(last_site_merged, last_avg_var_site)
  
}


last_total_volume_specialty_function <- function(site){
  
  # site <- "MSBI"
  last_specialty <- arrived_calculation_last_specialty %>%
    filter(Campus == site)
  
  last_total_volume_specialty <- last_specialty %>%
    arrange(match(Appt.Day, day_order)) %>%
    ungroup() %>%
    dplyr::select(Campus.Specialty.Group, Appt.Day, total_day) %>%
    mutate(Appt.Day = paste0(Appt.Day,"_total_day")) %>%
    pivot_wider(names_from = Appt.Day,
                values_from = total_day) %>%
    mutate(blank = "")
  
  last_avg_volume_specialty <- last_specialty %>%
    arrange(match(Appt.Day, day_order)) %>%
    ungroup() %>%
    dplyr::select(Campus.Specialty.Group, Appt.Day, avg_vol_day) %>%
    mutate(Appt.Day = paste0(Appt.Day,"_avg_day")) %>%
    pivot_wider(names_from = Appt.Day,
                values_from = avg_vol_day) %>%
    mutate(blank1 = "")

  last_avg_var_specialty <- last_specialty %>%
    arrange(match(Appt.Day, day_order)) %>%
    ungroup() %>%
    dplyr::select(Campus.Specialty.Group, Appt.Day, daily_var) %>%
    mutate(Appt.Day = paste0(Appt.Day,"_var")) %>%
    pivot_wider(names_from = Appt.Day,
                values_from = daily_var)

  last_specialty_merged <- merge(last_total_volume_specialty, last_avg_volume_specialty)
  last_specialty_merged <- merge(last_specialty_merged, last_avg_var_specialty)
  
}


```


```{r Site Volume Trend Function, echo = FALSE, warning = FALSE, message = FALSE}

day_order <- c('Mon','Tue','Wed','Thu','Fri')
site_order <- c("MSBI","MSDMG","MSH- AMBULATORY CARE","MSH-MSDFP","MSM","MSUS","MSW","NETWORK","ONCOLOGY","MSHS Total")

volume_trend_specialty_function <- function(site){
  
  # site <- "MSBI"
  volume_trend_specialty <- arrived_calculation_trend_specialty %>%
    filter(Appt.Year == current_year) %>%
    filter(Campus == site) %>%
    arrange(match(Appt.Day, day_order)) %>%
    ungroup() %>%
    mutate(daily_var = daily_var*100) %>%
    dplyr::select(Appt.MonthYear, Campus.Specialty.Group, Appt.Day, avg_vol_all, daily_var) %>%
    pivot_wider(names_from = Appt.Day,
                values_from = daily_var) %>%
    arrange(Appt.MonthYear)
  
}

```


```{r Site YTD No Show Function, echo = FALSE, warning = FALSE, message = FALSE}

no_show_ytd_site_function <- function(site){
  
  # site <- "MSUS"
  no_show_ytd_dept <- no_show_dept %>%
    filter(Campus == site) %>%
    filter(Appt.Year == current_year) %>%
    group_by(Campus, Campus.Specialty.Group, Department, New.PT2) %>%
    summarise(Arrived = sum(Arrived),
            `Arrived_sameDay` = sum(`Arrived_sameDay`),
            `Arrived_belowFourteen` = sum(`Arrived_belowFourteen`),
            `Arrived_belowThirty` = sum(`Arrived_belowThirty`),
            `Arrived_overThirty` = sum(`Arrived_overThirty`),
            `NoShow` = sum(`NoShow`),
            `NoShow_sameDay` = sum(`NoShow_sameDay`),
            `NoShow_belowFourteen` = sum(`NoShow_belowFourteen`),
            `NoShow_belowThirty` = sum(`NoShow_belowThirty`),
            `NoShow_overThirty` = sum(`NoShow_overThirty`),
            `SameDayCanceled` = sum(`SameDayCanceled`),
            `SameDayCanceled_sameDay` = sum(`SameDayCanceled_sameDay`),
            `SameDayCanceled_belowFourteen` = sum(`SameDayCanceled_belowFourteen`),
            `SameDayCanceled_belowThirty` = sum(`SameDayCanceled_belowThirty`),
            `SameDayCanceled_overThirty` = sum(`SameDayCanceled_overThirty`),
            Total = sum(Total),
            `Total_sameDay` = sum(`Total_sameDay`),
            `Total_belowFourteen` = sum(`Total_belowFourteen`),
            `Total_belowThirty` = sum(`Total_belowThirty`),
            `Total_overThirty` = sum(`Total_overThirty`)) %>%
  mutate(noShow_rate = round((`NoShow` + `SameDayCanceled`)/ Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/ `Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/ `Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/ `Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/ `Total_overThirty`,3)) %>%
    pivot_wider(names_from = New.PT2,
               values_from = 5:29,
                values_fill = 0) %>%
  mutate(Total = (Total_Established + Total_New),
         `Total_sameDay` = (`Total_sameDay_Established` + `Total_sameDay_New`),
         `Total_belowFourteen` = (`Total_belowFourteen_Established` + `Total_belowFourteen_New`),
         `Total_belowThirty` = (`Total_belowThirty_Established` + `Total_belowThirty_New`),
         `Total_overThirty` = (`Total_overThirty_Established` + `Total_overThirty_New`),
         Arrived = (Arrived_Established + Arrived_New),
         `Arrived_sameDay` = (`Arrived_sameDay_Established` + `Arrived_sameDay_New`),
         `Arrived_belowFourteen` = (`Arrived_belowFourteen_Established` + `Arrived_belowFourteen_New`),
         `Arrived_belowThirty` = (`Arrived_belowThirty_Established` + `Arrived_belowThirty_New`),
         `Arrived_overThirty` = (`Arrived_overThirty_Established` + `Arrived_overThirty_New`),
         NoShow = (NoShow_Established + NoShow_New),
         `NoShow_sameDay` = (`NoShow_sameDay_Established` + `NoShow_sameDay_New`),
         `NoShow_belowFourteen` = (`NoShow_belowFourteen_Established` + `NoShow_belowFourteen_New`),
         `NoShow_belowThirty` = (`NoShow_belowThirty_Established` + `NoShow_belowThirty_New`),
         `NoShow_overThirty` = (`NoShow_overThirty_Established` + `NoShow_overThirty_New`),
         SameDayCanceled = (SameDayCanceled_Established + SameDayCanceled_New),
         `SameDayCanceled_sameDay` = (`SameDayCanceled_sameDay_Established` + `SameDayCanceled_sameDay_New`),
         `SameDayCanceled_belowFourteen` = (`SameDayCanceled_belowFourteen_Established` + `SameDayCanceled_belowFourteen_New`),
         `SameDayCanceled_belowThirty` = (`SameDayCanceled_belowThirty_Established` + `SameDayCanceled_belowThirty_New`),
         `SameDayCanceled_overThirty` = (`SameDayCanceled_overThirty_Established` + `SameDayCanceled_overThirty_New`),
         noShow_rate = round((`NoShow_Established` + `SameDayCanceled_Established` + `NoShow_New` + `SameDayCanceled_New`)/Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/`Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/`Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/`Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/`Total_overThirty`,3),
         new_perc = round(Arrived_New/Arrived,3)) %>%
  group_by(Campus.Specialty.Group) %>%
  mutate(arrived_site = sum(Arrived),
         arrived_perc = round(Arrived/arrived_site,3)) %>%
    mutate_all(~ifelse(is.nan(.), NA, .))
  
  no_show_ytd_dept <- no_show_ytd_dept %>%
  dplyr::select(1:3, 59, 79, 81, 
                4:58, 60:78, 80)
  
}
```


```{r Site Last Year No Show Function, echo = FALSE, warning = FALSE, message = FALSE}

no_show_last_site_function <- function(site){
  
  # site <- "MSUS"
  no_show_last_dept <- no_show_dept %>%
    filter(Campus == site) %>%
    filter(Appt.Year == last_year) %>%
    group_by(Campus, Campus.Specialty.Group, Department, New.PT2) %>%
    summarise(Arrived = sum(Arrived),
            `Arrived_sameDay` = sum(`Arrived_sameDay`),
            `Arrived_belowFourteen` = sum(`Arrived_belowFourteen`),
            `Arrived_belowThirty` = sum(`Arrived_belowThirty`),
            `Arrived_overThirty` = sum(`Arrived_overThirty`),
            `NoShow` = sum(`NoShow`),
            `NoShow_sameDay` = sum(`NoShow_sameDay`),
            `NoShow_belowFourteen` = sum(`NoShow_belowFourteen`),
            `NoShow_belowThirty` = sum(`NoShow_belowThirty`),
            `NoShow_overThirty` = sum(`NoShow_overThirty`),
            `SameDayCanceled` = sum(`SameDayCanceled`),
            `SameDayCanceled_sameDay` = sum(`SameDayCanceled_sameDay`),
            `SameDayCanceled_belowFourteen` = sum(`SameDayCanceled_belowFourteen`),
            `SameDayCanceled_belowThirty` = sum(`SameDayCanceled_belowThirty`),
            `SameDayCanceled_overThirty` = sum(`SameDayCanceled_overThirty`),
            Total = sum(Total),
            `Total_sameDay` = sum(`Total_sameDay`),
            `Total_belowFourteen` = sum(`Total_belowFourteen`),
            `Total_belowThirty` = sum(`Total_belowThirty`),
            `Total_overThirty` = sum(`Total_overThirty`)) %>%
  mutate(noShow_rate = round((`NoShow` + `SameDayCanceled`)/ Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/ `Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/ `Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/ `Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/ `Total_overThirty`,3)) %>%
    pivot_wider(names_from = New.PT2,
               values_from = 5:29,
                values_fill = 0) %>%
  mutate(Total = (Total_Established + Total_New),
         `Total_sameDay` = (`Total_sameDay_Established` + `Total_sameDay_New`),
         `Total_belowFourteen` = (`Total_belowFourteen_Established` + `Total_belowFourteen_New`),
         `Total_belowThirty` = (`Total_belowThirty_Established` + `Total_belowThirty_New`),
         `Total_overThirty` = (`Total_overThirty_Established` + `Total_overThirty_New`),
         Arrived = (Arrived_Established + Arrived_New),
         `Arrived_sameDay` = (`Arrived_sameDay_Established` + `Arrived_sameDay_New`),
         `Arrived_belowFourteen` = (`Arrived_belowFourteen_Established` + `Arrived_belowFourteen_New`),
         `Arrived_belowThirty` = (`Arrived_belowThirty_Established` + `Arrived_belowThirty_New`),
         `Arrived_overThirty` = (`Arrived_overThirty_Established` + `Arrived_overThirty_New`),
         NoShow = (NoShow_Established + NoShow_New),
         `NoShow_sameDay` = (`NoShow_sameDay_Established` + `NoShow_sameDay_New`),
         `NoShow_belowFourteen` = (`NoShow_belowFourteen_Established` + `NoShow_belowFourteen_New`),
         `NoShow_belowThirty` = (`NoShow_belowThirty_Established` + `NoShow_belowThirty_New`),
         `NoShow_overThirty` = (`NoShow_overThirty_Established` + `NoShow_overThirty_New`),
         SameDayCanceled = (SameDayCanceled_Established + SameDayCanceled_New),
         `SameDayCanceled_sameDay` = (`SameDayCanceled_sameDay_Established` + `SameDayCanceled_sameDay_New`),
         `SameDayCanceled_belowFourteen` = (`SameDayCanceled_belowFourteen_Established` + `SameDayCanceled_belowFourteen_New`),
         `SameDayCanceled_belowThirty` = (`SameDayCanceled_belowThirty_Established` + `SameDayCanceled_belowThirty_New`),
         `SameDayCanceled_overThirty` = (`SameDayCanceled_overThirty_Established` + `SameDayCanceled_overThirty_New`),
         noShow_rate = round((`NoShow_Established` + `SameDayCanceled_Established` + `NoShow_New` + `SameDayCanceled_New`)/Total,3),
         `noShow_rate_sameDay` = round((`NoShow_sameDay` + `SameDayCanceled_sameDay`)/`Total_sameDay`,3),
         `noShow_rate_belowFourteen` = round((`NoShow_belowFourteen` + `SameDayCanceled_belowFourteen`)/`Total_belowFourteen`,3),
         `noShow_rate_belowThirty` = round((`NoShow_belowThirty` + `SameDayCanceled_belowThirty`)/`Total_belowThirty`,3),
         `noShow_rate_overThirty` = round((`NoShow_overThirty` + `SameDayCanceled_overThirty`)/`Total_overThirty`,3),
         new_perc = round(Arrived_New/Arrived,3)) %>%
  group_by(Campus.Specialty.Group) %>%
  mutate(arrived_site = sum(Arrived),
         arrived_perc = round(Arrived/arrived_site,3)) %>%
    mutate_all(~ifelse(is.nan(.), NA, .))

  no_show_last_dept <- no_show_last_dept %>%
  dplyr::select(1:3, 59, 79, 81, 
                4:58, 60:78, 80)
  
}
```


```{r Site No Show Trend Function, echo = FALSE, warning = FALSE, message = FALSE}

no_show_trend_site_function <- function(site){
  
  no_show_trend_site <- no_show_dept %>%
    filter(Campus == site) %>%
    group_by(Campus, Campus.Specialty.Group, Appt.MonthYear, New.PT2) %>%
    summarise(Arrived = sum(Arrived),
              `NoShow` = sum(`NoShow`),
              `SameDayCanceled` = sum(`SameDayCanceled`),
              Total = sum(Total)) %>%
    mutate(noShow_rate = round((`NoShow` + `SameDayCanceled`)/ Total,3)*100) %>%
    pivot_wider(names_from = New.PT2,
                values_from = 5:9,
                values_fill = 0) %>%
    mutate(Total = (Total_Established + Total_New),
           Arrived = (Arrived_Established + Arrived_New),
           noShow_rate = round((`NoShow_Established` + `SameDayCanceled_Established` + `NoShow_New` + `SameDayCanceled_New`)/Total,3)*100,
           new_perc = round(Total_New/Total,3)*100) %>%
    arrange(Appt.MonthYear)
}
```


## MSBI
### MSBI - No Show Plus Rate {.tabset .tabset-fade .tabset-pills}
#### `r current_year` YTD
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r MSBI No Show Output, echo = FALSE, warning = FALSE, message = FALSE}

# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('msbi_ytd_noshow-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_ytd_site_function("MSBI"),
  elementId = "msbi_ytd_noshow-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,

  groupBy = "Campus.Specialty.Group",

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(current_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Department = colDef(
      name = "Department",
      minWidth = 250),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)
```
<br/>
<br/>
<br/>

#### `r last_year`
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r MSBI No Show Last Year Output, echo = FALSE, warning = FALSE, message = FALSE}

# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('msbi_last_noshow-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_last_site_function("MSBI"),
  elementId = "msbi_last_noshow-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,

  groupBy = "Campus.Specialty.Group",

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(last_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Department = colDef(
      name = "Department",
      minWidth = 250),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)
```
<br/>
<br/>
<br/>

#### Trend
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate Trend by Specialty**</span><br/>
```{r MSBI No Show Trend, echo = FALSE, warning = FALSE, message = FALSE}

no_show_trend_site_output <- no_show_trend_site_function("MSBI")

map(unique(no_show_trend_site_output$Campus.Specialty.Group), function(x){
highchart() %>%
  hc_yAxis_multiples(
    # list(title = list(text = "Avg Volume per Day"), lineWidth = 3),
    list(title = list(text = "No Show Rate"), lineWidth = 3, 
         labels = list(format = '{value}%'),
         plotLines = list(list(value = 20, color = "red", width = 2,
                               dashStyle = "shortdash")))
           # showLastLabel = FALSE, opposite = TRUE)
  ) %>%
  hc_xAxis(title = list(text = ""),
           categories = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$Appt.MonthYear,
           type = "datetime",
           labels = list(format = '{value:%Y-%m}')
           # dateTimeLabelFormats = list(month = '%Y-%m')
           ) %>%
  # hc_add_series(name = "Total Visits",
  #               data = (volume_trend_mshs %>% filter(Campus == x))$avg_vol_all,
  #               type = 'column',
  #               color='#212070',
  #               dataLabels = list(enabled = TRUE, format='{point.y}')) %>%
  hc_add_series(name   = "Established",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_Established,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#212070',
                lineWidth=3,
                lineColor='#212070',
                labels = list(format = '{value:.2f}')
                ) %>%
  hc_add_series(name   = "New",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_New,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#d80b8c',
                lineWidth=3,
                lineColor='#d80b8c',
                labels = list(format = '{value:.2f}')
                ) %>%
  hc_add_series(name   = "All",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate,
               type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#7f7f7f',
                lineWidth=3,
                lineColor='#7f7f7f',
               labels = list(format = '{value:.2f}')
                ) %>%
  hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>%
  hc_title(text = paste0("MSBI ", x, " - Avg No Show Plus Rate"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>%
  hc_subtitle(text = "Target:",
              align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>%
    hc_tooltip(shared = TRUE, borderColor = "black", valueSuffix = "%")
  }) %>%
  hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable()

```
<br/>
<br/>
<br/>




## MSDMG
### MSDMG - No Shows {.tabset .tabset-fade .tabset-pills}
#### `r current_year` YTD
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r MSDMG No Show Output, echo = FALSE, warning = FALSE, message = FALSE}

# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('msdmg_ytd_noshow-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_ytd_site_function("MSDMG"),
  elementId = "msdmg_ytd_noshow-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,

  groupBy = "Campus.Specialty.Group",

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(current_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Department = colDef(
      name = "Department",
      minWidth = 250),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)
```
<br/>
<br/>
<br/>

#### `r last_year`
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r MSDMG No Show Last Year Output, echo = FALSE, warning = FALSE, message = FALSE}

# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('msdmg_last_noshow-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_last_site_function("MSDMG"),
  elementId = "msdmg_last_noshow-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,

  groupBy = "Campus.Specialty.Group",

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(last_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Department = colDef(
      name = "Department",
      minWidth = 250),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)
```
<br/>
<br/>
<br/>

#### Trend
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate Trend by Specialty**</span><br/>
```{r MSDMG No Show Trend, echo = FALSE, warning = FALSE, message = FALSE}

no_show_trend_site_output <- no_show_trend_site_function("MSDMG")

map(unique(no_show_trend_site_output$Campus.Specialty.Group), function(x){
highchart() %>%
  hc_yAxis_multiples(
    # list(title = list(text = "Avg Volume per Day"), lineWidth = 3),
    list(title = list(text = "No Show Rate"), lineWidth = 3, 
         labels = list(format = '{value}%'),
         plotLines = list(list(value = 20, color = "red", width = 2,
                               dashStyle = "shortdash")))
           # showLastLabel = FALSE, opposite = TRUE)
  ) %>%
  hc_xAxis(title = list(text = ""),
           categories = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$Appt.MonthYear,
           type = "datetime",
           labels = list(format = '{value:%Y-%m}')
           # dateTimeLabelFormats = list(month = '%Y-%m')
           ) %>%
  # hc_add_series(name = "Total Visits",
  #               data = (volume_trend_mshs %>% filter(Campus == x))$avg_vol_all,
  #               type = 'column',
  #               color='#212070',
  #               dataLabels = list(enabled = TRUE, format='{point.y}')) %>%
  hc_add_series(name   = "Established",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_Established,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#212070',
                lineWidth=3,
                lineColor='#212070',
                labels = list(format = '{value:.2f}')
                ) %>%
  hc_add_series(name   = "New",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_New,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#d80b8c',
                lineWidth=3,
                lineColor='#d80b8c',
                labels = list(format = '{value:.2f}')
                ) %>%
  hc_add_series(name   = "All",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate,
               type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#7f7f7f',
                lineWidth=3,
                lineColor='#7f7f7f',
               labels = list(format = '{value:.2f}')
                ) %>%
  hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>%
  hc_title(text = paste0("MSDMG ", x, " - Avg No Show Plus Rate"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>%
  hc_subtitle(text = "Target:",
              align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>%
    hc_tooltip(shared = TRUE, borderColor = "black", valueSuffix = "%")
  }) %>%
  hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable()

```
<br/>
<br/>
<br/>



## MSH- AMBULATORY CARE
### MSH- AMBULATORY CARE - No Shows {.tabset .tabset-fade .tabset-pills}
#### `r current_year` YTD
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r MSH- AMBULATORY CARE No Show Output, echo = FALSE, warning = FALSE, message = FALSE}

# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('amb_ytd_noshow-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_ytd_site_function("MSH- AMBULATORY CARE"),
  elementId = "amb_ytd_noshow-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,

  groupBy = "Campus.Specialty.Group",

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(current_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Department = colDef(
      name = "Department",
      minWidth = 250),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)
```
<br/>
<br/>
<br/>

#### `r last_year`
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r MSH- AMBULATORY CARE No Show Last Year Output, echo = FALSE, warning = FALSE, message = FALSE}

# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('amb_last_noshow-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_last_site_function("MSH- AMBULATORY CARE"),
  elementId = "amb_last_noshow-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,

  groupBy = "Campus.Specialty.Group",

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(last_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Department = colDef(
      name = "Department",
      minWidth = 250),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)
```
<br/>
<br/>
<br/>

#### Trend
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate Trend by Specialty**</span><br/>
```{r MSH- AMBULATORY CARE No Show Trend, echo = FALSE, warning = FALSE, message = FALSE}

no_show_trend_site_output <- no_show_trend_site_function("MSH- AMBULATORY CARE")

map(unique(no_show_trend_site_output$Campus.Specialty.Group), function(x){
highchart() %>%
  hc_yAxis_multiples(
    # list(title = list(text = "Avg Volume per Day"), lineWidth = 3),
    list(title = list(text = "No Show Rate"), lineWidth = 3, 
         labels = list(format = '{value}%'),
         plotLines = list(list(value = 20, color = "red", width = 2,
                               dashStyle = "shortdash")))
           # showLastLabel = FALSE, opposite = TRUE)
  ) %>%
  hc_xAxis(title = list(text = ""),
           categories = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$Appt.MonthYear,
           type = "datetime",
           labels = list(format = '{value:%Y-%m}')
           # dateTimeLabelFormats = list(month = '%Y-%m')
           ) %>%
  # hc_add_series(name = "Total Visits",
  #               data = (volume_trend_mshs %>% filter(Campus == x))$avg_vol_all,
  #               type = 'column',
  #               color='#212070',
  #               dataLabels = list(enabled = TRUE, format='{point.y}')) %>%
  hc_add_series(name   = "Established",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_Established,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#212070',
                lineWidth=3,
                lineColor='#212070',
                labels = list(format = '{value:.2f}')
                ) %>%
  hc_add_series(name   = "New",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_New,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#d80b8c',
                lineWidth=3,
                lineColor='#d80b8c',
                labels = list(format = '{value:.2f}')
                ) %>%
  hc_add_series(name   = "All",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate,
               type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#7f7f7f',
                lineWidth=3,
                lineColor='#7f7f7f',
               labels = list(format = '{value:.2f}')
                ) %>%
  hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>%
  hc_title(text = paste0("MSH- AMB CARE ", x, " - Avg No Show Plus Rate"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>%
  hc_subtitle(text = "Target:",
              align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>%
    hc_tooltip(shared = TRUE, borderColor = "black", valueSuffix = "%")
  }) %>%
  hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable()

```
<br/>
<br/>
<br/>




## MSH-MSDFP
### MSH-MSDFP - No Shows {.tabset .tabset-fade .tabset-pills}
#### `r current_year` YTD
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r MSH-MSDFP No Show Output, echo = FALSE, warning = FALSE, message = FALSE}

# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('msdfp_ytd_noshow-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_ytd_site_function("MSH-MSDFP"),
  elementId = "msdfp_ytd_noshow-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,

  groupBy = "Campus.Specialty.Group",

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(current_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Department = colDef(
      name = "Department",
      minWidth = 250),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)
```
<br/>
<br/>
<br/>

#### `r last_year`
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r MSH-MSDFP No Show Last Year Output, echo = FALSE, warning = FALSE, message = FALSE}

# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('msdfp_last_noshow-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_last_site_function("MSH-MSDFP"),
  elementId = "msdfp_last_noshow-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,

  groupBy = "Campus.Specialty.Group",

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(last_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Department = colDef(
      name = "Department",
      minWidth = 250),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)

```
<br/>
<br/>
<br/>

#### Trend
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate Trend by Specialty**</span><br/>
```{r MSH-MSDFP No Show Trend, echo = FALSE, warning = FALSE, message = FALSE}

no_show_trend_site_output <- no_show_trend_site_function("MSH-MSDFP")

map(unique(no_show_trend_site_output$Campus.Specialty.Group), function(x){
highchart() %>%
  hc_yAxis_multiples(
    # list(title = list(text = "Avg Volume per Day"), lineWidth = 3),
    list(title = list(text = "No Show Rate"), lineWidth = 3, 
         labels = list(format = '{value}%'),
         plotLines = list(list(value = 20, color = "red", width = 2,
                               dashStyle = "shortdash")))
           # showLastLabel = FALSE, opposite = TRUE)
  ) %>%
  hc_xAxis(title = list(text = ""),
           categories = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$Appt.MonthYear,
           type = "datetime",
           labels = list(format = '{value:%Y-%m}')
           # dateTimeLabelFormats = list(month = '%Y-%m')
           ) %>%
  # hc_add_series(name = "Total Visits",
  #               data = (volume_trend_mshs %>% filter(Campus == x))$avg_vol_all,
  #               type = 'column',
  #               color='#212070',
  #               dataLabels = list(enabled = TRUE, format='{point.y}')) %>%
  hc_add_series(name   = "Established",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_Established,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#212070',
                lineWidth=3,
                lineColor='#212070',
                labels = list(format = '{value:.2f}')
                ) %>%
  hc_add_series(name   = "New",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_New,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#d80b8c',
                lineWidth=3,
                lineColor='#d80b8c',
                labels = list(format = '{value:.2f}')
                ) %>%
  hc_add_series(name   = "All",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate,
               type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#7f7f7f',
                lineWidth=3,
                lineColor='#7f7f7f',
               labels = list(format = '{value:.2f}')
                ) %>%
  hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>%
  hc_title(text = paste0("MSH-MSDFP ", x, " - Avg No Show Rate"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>%
  hc_subtitle(text = "Target:",
              align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>%
    hc_tooltip(shared = TRUE, borderColor = "black", valueSuffix = "%")
  }) %>%
  hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable()

```
<br/>
<br/>
<br/>



## MSM
### MSM - No Shows {.tabset .tabset-fade .tabset-pills}
#### `r current_year` YTD
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r MSM No Show Output, echo = FALSE, warning = FALSE, message = FALSE}

# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('msm_ytd_noshow-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_ytd_site_function("MSM"),
  elementId = "msm_ytd_noshow-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,

  groupBy = "Campus.Specialty.Group",

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(current_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Department = colDef(
      name = "Department",
      minWidth = 250),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)
```
<br/>
<br/>
<br/>

#### `r last_year` 
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r MSM No Show Last Year Output, echo = FALSE, warning = FALSE, message = FALSE}

# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('msm_last_noshow-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_last_site_function("MSM"),
  elementId = "msm_last_noshow-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,

  groupBy = "Campus.Specialty.Group",

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(last_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Department = colDef(
      name = "Department",
      minWidth = 250),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)
```
<br/>
<br/>
<br/>

#### Trend
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate Trend by Specialty**</span><br/>
```{r MSM No Show Trend, echo = FALSE, warning = FALSE, message = FALSE}

no_show_trend_site_output <- no_show_trend_site_function("MSM")

map(unique(no_show_trend_site_output$Campus.Specialty.Group), function(x){
highchart() %>%
  hc_yAxis_multiples(
    # list(title = list(text = "Avg Volume per Day"), lineWidth = 3),
    list(title = list(text = "No Show Rate"), lineWidth = 3, 
         labels = list(format = '{value}%'),
         plotLines = list(list(value = 20, color = "red", width = 2,
                               dashStyle = "shortdash")))
           # showLastLabel = FALSE, opposite = TRUE)
  ) %>%
  hc_xAxis(title = list(text = ""),
           categories = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$Appt.MonthYear,
           type = "datetime",
           labels = list(format = '{value:%Y-%m}')
           # dateTimeLabelFormats = list(month = '%Y-%m')
           ) %>%
  # hc_add_series(name = "Total Visits",
  #               data = (volume_trend_mshs %>% filter(Campus == x))$avg_vol_all,
  #               type = 'column',
  #               color='#212070',
  #               dataLabels = list(enabled = TRUE, format='{point.y}')) %>%
  hc_add_series(name   = "Established",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_Established,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#212070',
                lineWidth=3,
                lineColor='#212070',
                labels = list(format = '{value:.2f}')
                ) %>%
  hc_add_series(name   = "New",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_New,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#d80b8c',
                lineWidth=3,
                lineColor='#d80b8c',
                labels = list(format = '{value:.2f}')
                ) %>%
  hc_add_series(name   = "All",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate,
               type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#7f7f7f',
                lineWidth=3,
                lineColor='#7f7f7f',
               labels = list(format = '{value:.2f}')
                ) %>%
  hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>%
  hc_title(text = paste0("MSM ", x, " - Avg No Show Plus Rate"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>%
  hc_subtitle(text = "Target:",
              align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>%
    hc_tooltip(shared = TRUE, borderColor = "black", valueSuffix = "%")
  }) %>%
  hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable()

```
<br/>
<br/>
<br/>



## MSUS
### MSUS - No Shows {.tabset .tabset-fade .tabset-pills}
#### `r current_year` YTD
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r MSUS No Show Output, echo = FALSE, warning = FALSE, message = FALSE}

# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('msus_ytd_noshow-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_ytd_site_function("MSUS"),
  elementId = "msus_ytd_noshow-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,

  groupBy = "Campus.Specialty.Group",

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(current_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Department = colDef(
      name = "Department",
      minWidth = 250),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)

```
<br/>
<br/>
<br/>

#### `r last_year` 
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r MSUS No Show Last Year Output, echo = FALSE, warning = FALSE, message = FALSE}

# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('msus_last_noshow-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_last_site_function("MSUS"),
  elementId = "msus_last_noshow-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,

  groupBy = "Campus.Specialty.Group",

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(last_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Department = colDef(
      name = "Department",
      minWidth = 250),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)
```
<br/>
<br/>
<br/>

#### Trend
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate Trend by Specialty**</span><br/>
```{r MSUS No Show Trend, echo = FALSE, warning = FALSE, message = FALSE}

no_show_trend_site_output <- no_show_trend_site_function("MSUS")

map(unique(no_show_trend_site_output$Campus.Specialty.Group), function(x){
highchart() %>%
  hc_yAxis_multiples(
    # list(title = list(text = "Avg Volume per Day"), lineWidth = 3),
    list(title = list(text = "No Show Rate"), lineWidth = 3, 
         labels = list(format = '{value}%'),
         plotLines = list(list(value = 20, color = "red", width = 2,
                               dashStyle = "shortdash")))
           # showLastLabel = FALSE, opposite = TRUE)
  ) %>%
  hc_xAxis(title = list(text = ""),
           categories = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$Appt.MonthYear,
           type = "datetime",
           labels = list(format = '{value:%Y-%m}')
           # dateTimeLabelFormats = list(month = '%Y-%m')
           ) %>%
  # hc_add_series(name = "Total Visits",
  #               data = (volume_trend_mshs %>% filter(Campus == x))$avg_vol_all,
  #               type = 'column',
  #               color='#212070',
  #               dataLabels = list(enabled = TRUE, format='{point.y}')) %>%
  hc_add_series(name   = "Established",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_Established,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#212070',
                lineWidth=3,
                lineColor='#212070',
                labels = list(format = '{value:.2f}')
                ) %>%
  hc_add_series(name   = "New",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_New,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#d80b8c',
                lineWidth=3,
                lineColor='#d80b8c',
                labels = list(format = '{value:.2f}')
                ) %>%
  hc_add_series(name   = "All",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate,
               type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#7f7f7f',
                lineWidth=3,
                lineColor='#7f7f7f',
               labels = list(format = '{value:.2f}')
                ) %>%
  hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>%
  hc_title(text = paste0("MSUS ", x, " - Avg No Show Plus Rate"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>%
  hc_subtitle(text = "Target:",
              align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>%
    hc_tooltip(shared = TRUE, borderColor = "black", valueSuffix = "%")
  }) %>%
  hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable()

```
<br/>
<br/>
<br/>



## MSW
### MSW - No Shows {.tabset .tabset-fade .tabset-pills}
#### `r current_year` YTD
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r MSW No Show Output, echo = FALSE, warning = FALSE, message = FALSE}

# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('msw_ytd_noshow-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_ytd_site_function("MSW"),
  elementId = "msw_ytd_noshow-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,

  groupBy = "Campus.Specialty.Group",

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(current_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Department = colDef(
      name = "Department",
      minWidth = 250),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)
```
<br/>
<br/>
<br/>

#### `r last_year` 
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r MSW No Show Last Year Output, echo = FALSE, warning = FALSE, message = FALSE}

# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('msw_last_noshow-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_last_site_function("MSW"),
  elementId = "msw_last_noshow-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,

  groupBy = "Campus.Specialty.Group",

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(last_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Department = colDef(
      name = "Department",
      minWidth = 250),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)

```
<br/>
<br/>
<br/>

#### Trend
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate Trend by Specialty**</span><br/>
```{r MSW No Show Trend, echo = FALSE, warning = FALSE, message = FALSE}

no_show_trend_site_output <- no_show_trend_site_function("MSW")

map(unique(no_show_trend_site_output$Campus.Specialty.Group), function(x){
highchart() %>%
  hc_yAxis_multiples(
    # list(title = list(text = "Avg Volume per Day"), lineWidth = 3),
    list(title = list(text = "No Show Rate"), lineWidth = 3, 
         labels = list(format = '{value}%'),
         plotLines = list(list(value = 20, color = "red", width = 2,
                               dashStyle = "shortdash")))
           # showLastLabel = FALSE, opposite = TRUE)
  ) %>%
  hc_xAxis(title = list(text = ""),
           categories = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$Appt.MonthYear,
           type = "datetime",
           labels = list(format = '{value:%Y-%m}')
           # dateTimeLabelFormats = list(month = '%Y-%m')
           ) %>%
  # hc_add_series(name = "Total Visits",
  #               data = (volume_trend_mshs %>% filter(Campus == x))$avg_vol_all,
  #               type = 'column',
  #               color='#212070',
  #               dataLabels = list(enabled = TRUE, format='{point.y}')) %>%
  hc_add_series(name   = "Established",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_Established,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#212070',
                lineWidth=3,
                lineColor='#212070',
                labels = list(format = '{value:.2f}')
                ) %>%
  hc_add_series(name   = "New",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_New,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#d80b8c',
                lineWidth=3,
                lineColor='#d80b8c',
                labels = list(format = '{value:.2f}')
                ) %>%
  hc_add_series(name   = "All",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate,
               type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#7f7f7f',
                lineWidth=3,
                lineColor='#7f7f7f',
               labels = list(format = '{value:.2f}')
                ) %>%
  hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>%
  hc_title(text = paste0("MSW ", x, " - Avg No Show Plus Rate"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>%
  hc_subtitle(text = "Target:",
              align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>%
    hc_tooltip(shared = TRUE, borderColor = "black", valueSuffix = "%")
  }) %>%
  hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable()

```
<br/>
<br/>
<br/>




## NETWORK
### NETWORK - No Shows {.tabset .tabset-fade .tabset-pills}
#### `r current_year` YTD
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r NETWORK No Show Output, echo = FALSE, warning = FALSE, message = FALSE}

# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('network_ytd_noshow-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_ytd_site_function("NETWORK"),
  elementId = "network_ytd_noshow-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,

  groupBy = "Campus.Specialty.Group",

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(current_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Department = colDef(
      name = "Department",
      minWidth = 250),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)
```
<br/>
<br/>
<br/>

#### `r last_year` 
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate by Specialty**</span><br/>
```{r NETWORK No Show Last Year Output, echo = FALSE, warning = FALSE, message = FALSE}

# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('network_last_noshow-download-table', 'Avg No Show Rate')"
    ),

reactable(
  no_show_last_site_function("NETWORK"),
  elementId = "network_last_noshow-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 700,
    wrap = TRUE,
  searchable = TRUE,

  groupBy = "Campus.Specialty.Group",

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left",
             headerStyle = list(fontSize = "16px")),
    colGroup(name = paste0(last_year, " YTD Visit Volume"), 
             columns = c("Arrived","arrived_perc","new_perc"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - All", 
             columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - Established", 
             columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "No Show Plus Rate - New", 
             columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    Campus.Specialty.Group = colDef(
      name = "Specialty",
      minWidth = 250),
    
    Department = colDef(
      name = "Department",
      minWidth = 250),
    
    Arrived = colDef(
      name = "Total Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    arrived_perc = colDef(
      name = "% of Site Total Arrived Visits",
      maxWidth = 90,
     headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = JS("function(values, rows) {
      #   let totalArrived = 0
      #   let totalarrived_site = 0
      #   rows.forEach(function(row) {
      #     totalArrived += row['Arrived']
      #     totalarrived_site += row['arrived_site']
      #   })
      #   return totalArrived / totalarrived_site
      # }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_perc = colDef(
      name = "% New Arrived Visits",
      maxWidth = 90,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalArrived_New = 0
        let totalArrived = 0
        rows.forEach(function(row) {
          totalArrived_New += row['Arrived_New']
          totalArrived += row['Arrived']
        })
        return (totalArrived_New) / totalArrived
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_Established` = colDef(
      name = "All Established",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_Established = 0
        let totalSameDayCanceled_Established = 0
        let totalTotal_Established = 0
        rows.forEach(function(row) {
          totalNoShow_Established += row['NoShow_Established']
          totalSameDayCanceled_Established += row['SameDayCanceled_Established']
          totalTotal_Established += row['Total_Established']
        })
        return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    `noShow_rate_sameDay_Established` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_Established = 0
        let totalSameDayCanceled_sameDay_Established = 0
        let totalTotal_sameDay_Established = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_Established += row['NoShow_sameDay_Established']
          totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established']
          totalTotal_sameDay_Established += row['Total_sameDay_Established']
        })
        return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_belowFourteen_Established` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_Established = 0
        let totalSameDayCanceled_belowFourteen_Established = 0
        let totalTotal_belowFourteen_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established']
          totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established']
          totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established']
        })
        return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_Established` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_Established = 0
        let totalSameDayCanceled_belowThirty_Established = 0
        let totalTotal_belowThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established']
          totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established']
          totalTotal_belowThirty_Established += row['Total_belowThirty_Established']
        })
        return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_Established` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_Established = 0
        let totalSameDayCanceled_overThirty_Established = 0
        let totalTotal_overThirty_Established = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_Established += row['NoShow_overThirty_Established']
          totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established']
          totalTotal_overThirty_Established += row['Total_overThirty_Established']
        })
        return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_New` = colDef(
      name = "All New",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_New = 0
        let totalSameDayCanceled_New = 0
        let totalTotal_New = 0
        rows.forEach(function(row) {
          totalNoShow_New += row['NoShow_New']
          totalSameDayCanceled_New += row['SameDayCanceled_New']
          totalTotal_New += row['Total_New']
        })
        return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_sameDay_New` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay_New = 0
        let totalSameDayCanceled_sameDay_New = 0
        let totalTotal_sameDay_New = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay_New += row['NoShow_sameDay_New']
          totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New']
          totalTotal_sameDay_New += row['Total_sameDay_New']
        })
        return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen_New` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen_New = 0
        let totalSameDayCanceled_belowFourteen_New = 0
        let totalTotal_belowFourteen_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New']
          totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New']
          totalTotal_belowFourteen_New += row['Total_belowFourteen_New']
        })
        return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_belowThirty_New` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty_New = 0
        let totalSameDayCanceled_belowThirty_New = 0
        let totalTotal_belowThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty_New += row['NoShow_belowThirty_New']
          totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New']
          totalTotal_belowThirty_New += row['Total_belowThirty_New']
        })
        return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty_New` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty_New = 0
        let totalSameDayCanceled_overThirty_New = 0
        let totalTotal_overThirty_New = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty_New += row['NoShow_overThirty_New']
          totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New']
          totalTotal_overThirty_New += row['Total_overThirty_New']
        })
        return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate` = colDef(
      name = "All",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow = 0
        let totalSameDayCanceled = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalNoShow += row['NoShow']
          totalSameDayCanceled += row['SameDayCanceled']
          totalTotal += row['Total']
        })
        return (totalNoShow + totalSameDayCanceled) / totalTotal || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
   `noShow_rate_sameDay` = colDef(
      name = "Scheduled Same-Day",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_sameDay = 0
        let totalSameDayCanceled_sameDay = 0
        let totalTotal_sameDay = 0
        rows.forEach(function(row) {
          totalNoShow_sameDay += row['NoShow_sameDay']
          totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay']
          totalTotal_sameDay += row['Total_sameDay']
        })
        return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
   `noShow_rate_belowFourteen` = colDef(
      name = "Scheduled 1-14 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowFourteen = 0
        let totalSameDayCanceled_belowFourteen = 0
        let totalTotal_belowFourteen = 0
        rows.forEach(function(row) {
          totalNoShow_belowFourteen += row['NoShow_belowFourteen']
          totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen']
          totalTotal_belowFourteen += row['Total_belowFourteen']
        })
        return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
   
    `noShow_rate_belowThirty` = colDef(
      name = "Scheduled 15-30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_belowThirty = 0
        let totalSameDayCanceled_belowThirty = 0
        let totalTotal_belowThirty = 0
        rows.forEach(function(row) {
          totalNoShow_belowThirty += row['NoShow_belowThirty']
          totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty']
          totalTotal_belowThirty += row['Total_belowThirty']
        })
        return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    `noShow_rate_overThirty` = colDef(
      name = "Scheduled >30 Days",
      maxWidth = 90,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalNoShow_overThirty = 0
        let totalSameDayCanceled_overThirty = 0
        let totalTotal_overThirty = 0
        rows.forEach(function(row) {
          totalNoShow_overThirty += row['NoShow_overThirty']
          totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty']
          totalTotal_overThirty += row['Total_overThirty']
        })
        return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 1),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    Arrived_Established = colDef(show =F),
    Arrived_New = colDef(show =F),
    Arrived_sameDay_Established = colDef(show =F),
    Arrived_sameDay_New = colDef(show =F),
    Arrived_belowFourteen_Established = colDef(show =F),
    Arrived_belowFourteen_New = colDef(show =F),
    Arrived_belowThirty_Established = colDef(show =F),
    Arrived_belowThirty_New = colDef(show =F),
    Arrived_overThirty_Established = colDef(show =F),
    Arrived_overThirty_New = colDef(show =F),
    
    NoShow_Established = colDef(show =F),
    NoShow_New = colDef(show =F),
    NoShow_sameDay_Established = colDef(show =F),
    NoShow_sameDay_New = colDef(show =F),
    NoShow_belowFourteen_Established = colDef(show =F),
    NoShow_belowFourteen_New = colDef(show =F),
    NoShow_belowThirty_Established = colDef(show =F),
    NoShow_belowThirty_New = colDef(show =F),
    NoShow_overThirty_Established = colDef(show =F),
    NoShow_overThirty_New = colDef(show =F),
    
    SameDayCanceled_Established = colDef(show =F),
    SameDayCanceled_New = colDef(show =F),
    SameDayCanceled_sameDay_Established = colDef(show =F),
    SameDayCanceled_sameDay_New = colDef(show =F),
    SameDayCanceled_belowFourteen_Established = colDef(show =F),
    SameDayCanceled_belowFourteen_New = colDef(show =F),
    SameDayCanceled_belowThirty_Established = colDef(show =F),
    SameDayCanceled_belowThirty_New = colDef(show =F),
    SameDayCanceled_overThirty_Established = colDef(show =F),
    SameDayCanceled_overThirty_New = colDef(show =F),
    
    Total_Established = colDef(show =F),
    Total_New = colDef(show =F),
    Total_sameDay_Established = colDef(show =F),
    Total_sameDay_New = colDef(show =F),
    Total_belowFourteen_Established = colDef(show =F),
    Total_belowFourteen_New = colDef(show =F),
    Total_belowThirty_Established = colDef(show =F),
    Total_belowThirty_New = colDef(show =F),
    Total_overThirty_Established = colDef(show =F),
    Total_overThirty_New = colDef(show =F),
    
    Total = colDef(show =F),
    Total_sameDay = colDef(show =F),
    Total_belowFourteen = colDef(show =F),
    Total_belowThirty = colDef(show =F),
    Total_overThirty = colDef(show =F),
    
    Arrived_sameDay = colDef(show =F),
    Arrived_belowFourteen = colDef(show =F),
    Arrived_belowThirty = colDef(show =F),
    Arrived_overThirty = colDef(show =F),
    
    NoShow = colDef(show =F),
    NoShow_sameDay = colDef(show =F),
    NoShow_belowFourteen = colDef(show =F),
    NoShow_belowThirty = colDef(show =F),
    NoShow_overThirty = colDef(show =F),
    
    SameDayCanceled = colDef(show =F),
    SameDayCanceled_sameDay = colDef(show =F),
    SameDayCanceled_belowFourteen = colDef(show =F),
    SameDayCanceled_belowThirty = colDef(show =F),
    SameDayCanceled_overThirty = colDef(show =F),
    arrived_site = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

 )
)
```
<br/>
<br/>
<br/>

#### Trend
<span style='font-size: 20px; color: #212070'>**No Show Plus Rate Trend by Specialty**</span><br/>
```{r NETWORK No Show Trend, echo = FALSE, warning = FALSE, message = FALSE}

no_show_trend_site_output <- no_show_trend_site_function("NETWORK")

map(unique(no_show_trend_site_output$Campus.Specialty.Group), function(x){
highchart() %>%
  hc_yAxis_multiples(
    # list(title = list(text = "Avg Volume per Day"), lineWidth = 3),
    list(title = list(text = "No Show Rate"), lineWidth = 3, 
         labels = list(format = '{value}%'),
         plotLines = list(list(value = 20, color = "red", width = 2,
                               dashStyle = "shortdash")))
           # showLastLabel = FALSE, opposite = TRUE)
  ) %>%
  hc_xAxis(title = list(text = ""),
           categories = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$Appt.MonthYear,
           type = "datetime",
           labels = list(format = '{value:%Y-%m}')
           # dateTimeLabelFormats = list(month = '%Y-%m')
           ) %>%
  # hc_add_series(name = "Total Visits",
  #               data = (volume_trend_mshs %>% filter(Campus == x))$avg_vol_all,
  #               type = 'column',
  #               color='#212070',
  #               dataLabels = list(enabled = TRUE, format='{point.y}')) %>%
  hc_add_series(name   = "Established",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_Established,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#212070',
                lineWidth=3,
                lineColor='#212070',
                labels = list(format = '{value:.2f}')
                ) %>%
  hc_add_series(name   = "New",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_New,
                type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#d80b8c',
                lineWidth=3,
                lineColor='#d80b8c',
                labels = list(format = '{value:.2f}')
                ) %>%
  hc_add_series(name   = "All",
                data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate,
               type = 'line', 
                # color = '#a5a7a5'
                marker = list(enabled= TRUE),
                color='#7f7f7f',
                lineWidth=3,
                lineColor='#7f7f7f',
               labels = list(format = '{value:.2f}')
                ) %>%
  hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>%
  hc_title(text = paste0("NETWORK ", x, " - Avg No Show Plus Rate"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>%
  hc_subtitle(text = "Target:",
              align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>%
    hc_tooltip(shared = TRUE, borderColor = "black", valueSuffix = "%")
  }) %>%
  hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable()

```
<br/>
<br/>
<br/>




<!-- ### ONCOLOGY - No Shows {.tabset .tabset-fade .tabset-pills} -->
<!-- #### `r current_year` YTD -->
<!-- ```{r ONCOLOGY No Show Output, echo = FALSE, warning = FALSE, message = FALSE} -->

<!-- # Table Output ----------------------------------------------------------------- -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       tagList(fontawesome::fa("download"), "Download Table"), -->
<!--       onclick = "Reactable.downloadDataCSV('onc_ytd_noshow-download-table', 'Avg No Show Rate')" -->
<!--     ), -->

<!-- reactable( -->
<!--   no_show_ytd_site_function("ONCOLOGY"), -->
<!--   elementId = "onc_ytd_noshow-download-table", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "Campus.Specialty.Group", -->

<!--   columnGroups = list( -->
<!--     # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"),  -->
<!--     #          columns = c("Total", "new_perc"), -->
<!--     #          headerStyle = list(color = "#212070", fontSize = "16px")), -->
<!--     # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"),  -->
<!--     #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"), -->
<!--     #          headerStyle = list(color = "#d80b8c", fontSize = "16px")) -->
<!--     colGroup(name = "",  -->
<!--              columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left", -->
<!--              headerStyle = list(fontSize = "16px")), -->
<!--     colGroup(name = paste0(current_year, " YTD Visit Volume"),  -->
<!--              columns = c("Arrived","arrived_perc","new_perc"), -->
<!--              headerStyle = list(color = "#212070", fontSize = "16px")), -->
<!--     colGroup(name = "No Show Plus Rate - All",  -->
<!--              columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"), -->
<!--              headerStyle = list(color = "#7f7f7f", fontSize = "16px")), -->
<!--     colGroup(name = "No Show Plus Rate - Established",  -->
<!--              columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"), -->
<!--              headerStyle = list(color = "#d80b8c", fontSize = "16px")), -->
<!--     colGroup(name = "No Show Plus Rate - New",  -->
<!--              columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"), -->
<!--              headerStyle = list(color = "#00aeef", fontSize = "16px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     Campus.Specialty.Group = colDef( -->
<!--       name = "Specialty", -->
<!--       minWidth = 250), -->

<!--     Department = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Arrived = colDef( -->
<!--       name = "Total Arrived Visits", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = 'sum', -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     arrived_perc = colDef( -->
<!--       name = "% of Site Total Arrived Visits", -->
<!--       maxWidth = 90, -->
<!--      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = JS("function(values, rows) { -->
<!--       #   let totalArrived = 0 -->
<!--       #   let totalarrived_site = 0 -->
<!--       #   rows.forEach(function(row) { -->
<!--       #     totalArrived += row['Arrived'] -->
<!--       #     totalarrived_site += row['arrived_site'] -->
<!--       #   }) -->
<!--       #   return totalArrived / totalarrived_site -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_perc = colDef( -->
<!--       name = "% New Arrived Visits", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived_New = 0 -->
<!--         let totalArrived = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalArrived_New += row['Arrived_New'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return (totalArrived_New) / totalArrived -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_Established` = colDef( -->
<!--       name = "All Established", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_Established = 0 -->
<!--         let totalSameDayCanceled_Established = 0 -->
<!--         let totalTotal_Established = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_Established += row['NoShow_Established'] -->
<!--           totalSameDayCanceled_Established += row['SameDayCanceled_Established'] -->
<!--           totalTotal_Established += row['Total_Established'] -->
<!--         }) -->
<!--         return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_sameDay_Established` = colDef( -->
<!--       name = "Scheduled Same-Day", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_sameDay_Established = 0 -->
<!--         let totalSameDayCanceled_sameDay_Established = 0 -->
<!--         let totalTotal_sameDay_Established = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_sameDay_Established += row['NoShow_sameDay_Established'] -->
<!--           totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established'] -->
<!--           totalTotal_sameDay_Established += row['Total_sameDay_Established'] -->
<!--         }) -->
<!--         return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--    `noShow_rate_belowFourteen_Established` = colDef( -->
<!--       name = "Scheduled 1-14 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_belowFourteen_Established = 0 -->
<!--         let totalSameDayCanceled_belowFourteen_Established = 0 -->
<!--         let totalTotal_belowFourteen_Established = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established'] -->
<!--           totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established'] -->
<!--           totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established'] -->
<!--         }) -->
<!--         return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_belowThirty_Established` = colDef( -->
<!--       name = "Scheduled 15-30 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_belowThirty_Established = 0 -->
<!--         let totalSameDayCanceled_belowThirty_Established = 0 -->
<!--         let totalTotal_belowThirty_Established = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established'] -->
<!--           totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established'] -->
<!--           totalTotal_belowThirty_Established += row['Total_belowThirty_Established'] -->
<!--         }) -->
<!--         return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_overThirty_Established` = colDef( -->
<!--       name = "Scheduled >30 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_overThirty_Established = 0 -->
<!--         let totalSameDayCanceled_overThirty_Established = 0 -->
<!--         let totalTotal_overThirty_Established = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_overThirty_Established += row['NoShow_overThirty_Established'] -->
<!--           totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established'] -->
<!--           totalTotal_overThirty_Established += row['Total_overThirty_Established'] -->
<!--         }) -->
<!--         return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_New` = colDef( -->
<!--       name = "All New", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_New = 0 -->
<!--         let totalSameDayCanceled_New = 0 -->
<!--         let totalTotal_New = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_New += row['NoShow_New'] -->
<!--           totalSameDayCanceled_New += row['SameDayCanceled_New'] -->
<!--           totalTotal_New += row['Total_New'] -->
<!--         }) -->
<!--         return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--    `noShow_rate_sameDay_New` = colDef( -->
<!--       name = "Scheduled Same-Day", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_sameDay_New = 0 -->
<!--         let totalSameDayCanceled_sameDay_New = 0 -->
<!--         let totalTotal_sameDay_New = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_sameDay_New += row['NoShow_sameDay_New'] -->
<!--           totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New'] -->
<!--           totalTotal_sameDay_New += row['Total_sameDay_New'] -->
<!--         }) -->
<!--         return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--    `noShow_rate_belowFourteen_New` = colDef( -->
<!--       name = "Scheduled 1-14 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_belowFourteen_New = 0 -->
<!--         let totalSameDayCanceled_belowFourteen_New = 0 -->
<!--         let totalTotal_belowFourteen_New = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New'] -->
<!--           totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New'] -->
<!--           totalTotal_belowFourteen_New += row['Total_belowFourteen_New'] -->
<!--         }) -->
<!--         return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_belowThirty_New` = colDef( -->
<!--       name = "Scheduled 15-30 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_belowThirty_New = 0 -->
<!--         let totalSameDayCanceled_belowThirty_New = 0 -->
<!--         let totalTotal_belowThirty_New = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_belowThirty_New += row['NoShow_belowThirty_New'] -->
<!--           totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New'] -->
<!--           totalTotal_belowThirty_New += row['Total_belowThirty_New'] -->
<!--         }) -->
<!--         return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_overThirty_New` = colDef( -->
<!--       name = "Scheduled >30 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_overThirty_New = 0 -->
<!--         let totalSameDayCanceled_overThirty_New = 0 -->
<!--         let totalTotal_overThirty_New = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_overThirty_New += row['NoShow_overThirty_New'] -->
<!--           totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New'] -->
<!--           totalTotal_overThirty_New += row['Total_overThirty_New'] -->
<!--         }) -->
<!--         return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate` = colDef( -->
<!--       name = "All", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow = 0 -->
<!--         let totalSameDayCanceled = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow += row['NoShow'] -->
<!--           totalSameDayCanceled += row['SameDayCanceled'] -->
<!--           totalTotal += row['Total'] -->
<!--         }) -->
<!--         return (totalNoShow + totalSameDayCanceled) / totalTotal || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--    `noShow_rate_sameDay` = colDef( -->
<!--       name = "Scheduled Same-Day", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_sameDay = 0 -->
<!--         let totalSameDayCanceled_sameDay = 0 -->
<!--         let totalTotal_sameDay = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_sameDay += row['NoShow_sameDay'] -->
<!--           totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay'] -->
<!--           totalTotal_sameDay += row['Total_sameDay'] -->
<!--         }) -->
<!--         return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--    `noShow_rate_belowFourteen` = colDef( -->
<!--       name = "Scheduled 1-14 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_belowFourteen = 0 -->
<!--         let totalSameDayCanceled_belowFourteen = 0 -->
<!--         let totalTotal_belowFourteen = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_belowFourteen += row['NoShow_belowFourteen'] -->
<!--           totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen'] -->
<!--           totalTotal_belowFourteen += row['Total_belowFourteen'] -->
<!--         }) -->
<!--         return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_belowThirty` = colDef( -->
<!--       name = "Scheduled 15-30 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_belowThirty = 0 -->
<!--         let totalSameDayCanceled_belowThirty = 0 -->
<!--         let totalTotal_belowThirty = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_belowThirty += row['NoShow_belowThirty'] -->
<!--           totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty'] -->
<!--           totalTotal_belowThirty += row['Total_belowThirty'] -->
<!--         }) -->
<!--         return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_overThirty` = colDef( -->
<!--       name = "Scheduled >30 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_overThirty = 0 -->
<!--         let totalSameDayCanceled_overThirty = 0 -->
<!--         let totalTotal_overThirty = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_overThirty += row['NoShow_overThirty'] -->
<!--           totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty'] -->
<!--           totalTotal_overThirty += row['Total_overThirty'] -->
<!--         }) -->
<!--         return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived_Established = colDef(show =F), -->
<!--     Arrived_New = colDef(show =F), -->
<!--     Arrived_sameDay_Established = colDef(show =F), -->
<!--     Arrived_sameDay_New = colDef(show =F), -->
<!--     Arrived_belowFourteen_Established = colDef(show =F), -->
<!--     Arrived_belowFourteen_New = colDef(show =F), -->
<!--     Arrived_belowThirty_Established = colDef(show =F), -->
<!--     Arrived_belowThirty_New = colDef(show =F), -->
<!--     Arrived_overThirty_Established = colDef(show =F), -->
<!--     Arrived_overThirty_New = colDef(show =F), -->

<!--     NoShow_Established = colDef(show =F), -->
<!--     NoShow_New = colDef(show =F), -->
<!--     NoShow_sameDay_Established = colDef(show =F), -->
<!--     NoShow_sameDay_New = colDef(show =F), -->
<!--     NoShow_belowFourteen_Established = colDef(show =F), -->
<!--     NoShow_belowFourteen_New = colDef(show =F), -->
<!--     NoShow_belowThirty_Established = colDef(show =F), -->
<!--     NoShow_belowThirty_New = colDef(show =F), -->
<!--     NoShow_overThirty_Established = colDef(show =F), -->
<!--     NoShow_overThirty_New = colDef(show =F), -->

<!--     SameDayCanceled_Established = colDef(show =F), -->
<!--     SameDayCanceled_New = colDef(show =F), -->
<!--     SameDayCanceled_sameDay_Established = colDef(show =F), -->
<!--     SameDayCanceled_sameDay_New = colDef(show =F), -->
<!--     SameDayCanceled_belowFourteen_Established = colDef(show =F), -->
<!--     SameDayCanceled_belowFourteen_New = colDef(show =F), -->
<!--     SameDayCanceled_belowThirty_Established = colDef(show =F), -->
<!--     SameDayCanceled_belowThirty_New = colDef(show =F), -->
<!--     SameDayCanceled_overThirty_Established = colDef(show =F), -->
<!--     SameDayCanceled_overThirty_New = colDef(show =F), -->

<!--     Total_Established = colDef(show =F), -->
<!--     Total_New = colDef(show =F), -->
<!--     Total_sameDay_Established = colDef(show =F), -->
<!--     Total_sameDay_New = colDef(show =F), -->
<!--     Total_belowFourteen_Established = colDef(show =F), -->
<!--     Total_belowFourteen_New = colDef(show =F), -->
<!--     Total_belowThirty_Established = colDef(show =F), -->
<!--     Total_belowThirty_New = colDef(show =F), -->
<!--     Total_overThirty_Established = colDef(show =F), -->
<!--     Total_overThirty_New = colDef(show =F), -->

<!--     Total = colDef(show =F), -->
<!--     Total_sameDay = colDef(show =F), -->
<!--     Total_belowFourteen = colDef(show =F), -->
<!--     Total_belowThirty = colDef(show =F), -->
<!--     Total_overThirty = colDef(show =F), -->

<!--     Arrived_sameDay = colDef(show =F), -->
<!--     Arrived_belowFourteen = colDef(show =F), -->
<!--     Arrived_belowThirty = colDef(show =F), -->
<!--     Arrived_overThirty = colDef(show =F), -->

<!--     NoShow = colDef(show =F), -->
<!--     NoShow_sameDay = colDef(show =F), -->
<!--     NoShow_belowFourteen = colDef(show =F), -->
<!--     NoShow_belowThirty = colDef(show =F), -->
<!--     NoShow_overThirty = colDef(show =F), -->

<!--     SameDayCanceled = colDef(show =F), -->
<!--     SameDayCanceled_sameDay = colDef(show =F), -->
<!--     SameDayCanceled_belowFourteen = colDef(show =F), -->
<!--     SameDayCanceled_belowThirty = colDef(show =F), -->
<!--     SameDayCanceled_overThirty = colDef(show =F), -->
<!--     arrived_site = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->
<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->
<!-- <br/> -->

<!-- #### `r last_year`  -->
<!-- ```{r ONCOLOGY Last Year No Show Output, echo = FALSE, warning = FALSE, message = FALSE} -->

<!-- # Table Output ----------------------------------------------------------------- -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       tagList(fontawesome::fa("download"), "Download Table"), -->
<!--       onclick = "Reactable.downloadDataCSV('onc_last_noshow-download-table', 'Avg No Show Rate')" -->
<!--     ), -->

<!-- reactable( -->
<!--   no_show_last_site_function("ONCOLOGY"), -->
<!--   elementId = "onc_last_noshow-download-table", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "Campus.Specialty.Group", -->

<!--   columnGroups = list( -->
<!--     # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"),  -->
<!--     #          columns = c("Total", "new_perc"), -->
<!--     #          headerStyle = list(color = "#212070", fontSize = "16px")), -->
<!--     # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"),  -->
<!--     #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"), -->
<!--     #          headerStyle = list(color = "#d80b8c", fontSize = "16px")) -->
<!--     colGroup(name = "",  -->
<!--              columns = c("Campus","Campus.Specialty.Group","Department"), sticky = "left", -->
<!--              headerStyle = list(fontSize = "16px")), -->
<!--     colGroup(name = paste0(last_year, " YTD Visit Volume"),  -->
<!--              columns = c("Arrived","arrived_perc","new_perc"), -->
<!--              headerStyle = list(color = "#212070", fontSize = "16px")), -->
<!--     colGroup(name = "No Show Plus Rate - All",  -->
<!--              columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"), -->
<!--              headerStyle = list(color = "#7f7f7f", fontSize = "16px")), -->
<!--     colGroup(name = "No Show Plus Rate - Established",  -->
<!--              columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"), -->
<!--              headerStyle = list(color = "#d80b8c", fontSize = "16px")), -->
<!--     colGroup(name = "No Show Plus Rate - New",  -->
<!--              columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"), -->
<!--              headerStyle = list(color = "#00aeef", fontSize = "16px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     Campus.Specialty.Group = colDef( -->
<!--       name = "Specialty", -->
<!--       minWidth = 250), -->

<!--     Department = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Arrived = colDef( -->
<!--       name = "Total Arrived Visits", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = 'sum', -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     arrived_perc = colDef( -->
<!--       name = "% of Site Total Arrived Visits", -->
<!--       maxWidth = 90, -->
<!--      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = JS("function(values, rows) { -->
<!--       #   let totalArrived = 0 -->
<!--       #   let totalarrived_site = 0 -->
<!--       #   rows.forEach(function(row) { -->
<!--       #     totalArrived += row['Arrived'] -->
<!--       #     totalarrived_site += row['arrived_site'] -->
<!--       #   }) -->
<!--       #   return totalArrived / totalarrived_site -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_perc = colDef( -->
<!--       name = "% New Arrived Visits", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived_New = 0 -->
<!--         let totalArrived = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalArrived_New += row['Arrived_New'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return (totalArrived_New) / totalArrived -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_Established` = colDef( -->
<!--       name = "All Established", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_Established = 0 -->
<!--         let totalSameDayCanceled_Established = 0 -->
<!--         let totalTotal_Established = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_Established += row['NoShow_Established'] -->
<!--           totalSameDayCanceled_Established += row['SameDayCanceled_Established'] -->
<!--           totalTotal_Established += row['Total_Established'] -->
<!--         }) -->
<!--         return (totalNoShow_Established + totalSameDayCanceled_Established) / totalTotal_Established || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_sameDay_Established` = colDef( -->
<!--       name = "Scheduled Same-Day", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_sameDay_Established = 0 -->
<!--         let totalSameDayCanceled_sameDay_Established = 0 -->
<!--         let totalTotal_sameDay_Established = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_sameDay_Established += row['NoShow_sameDay_Established'] -->
<!--           totalSameDayCanceled_sameDay_Established += row['SameDayCanceled_sameDay_Established'] -->
<!--           totalTotal_sameDay_Established += row['Total_sameDay_Established'] -->
<!--         }) -->
<!--         return (totalNoShow_sameDay_Established + totalSameDayCanceled_sameDay_Established) / totalTotal_sameDay_Established || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--    `noShow_rate_belowFourteen_Established` = colDef( -->
<!--       name = "Scheduled 1-14 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_belowFourteen_Established = 0 -->
<!--         let totalSameDayCanceled_belowFourteen_Established = 0 -->
<!--         let totalTotal_belowFourteen_Established = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_belowFourteen_Established += row['NoShow_belowFourteen_Established'] -->
<!--           totalSameDayCanceled_belowFourteen_Established += row['SameDayCanceled_belowFourteen_Established'] -->
<!--           totalTotal_belowFourteen_Established += row['Total_belowFourteen_Established'] -->
<!--         }) -->
<!--         return (totalNoShow_belowFourteen_Established + totalSameDayCanceled_belowFourteen_Established) / totalTotal_belowFourteen_Established || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_belowThirty_Established` = colDef( -->
<!--       name = "Scheduled 15-30 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_belowThirty_Established = 0 -->
<!--         let totalSameDayCanceled_belowThirty_Established = 0 -->
<!--         let totalTotal_belowThirty_Established = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_belowThirty_Established += row['NoShow_belowThirty_Established'] -->
<!--           totalSameDayCanceled_belowThirty_Established += row['SameDayCanceled_belowThirty_Established'] -->
<!--           totalTotal_belowThirty_Established += row['Total_belowThirty_Established'] -->
<!--         }) -->
<!--         return (totalNoShow_belowThirty_Established + totalSameDayCanceled_belowThirty_Established) / totalTotal_belowThirty_Established || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_overThirty_Established` = colDef( -->
<!--       name = "Scheduled >30 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_overThirty_Established = 0 -->
<!--         let totalSameDayCanceled_overThirty_Established = 0 -->
<!--         let totalTotal_overThirty_Established = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_overThirty_Established += row['NoShow_overThirty_Established'] -->
<!--           totalSameDayCanceled_overThirty_Established += row['SameDayCanceled_overThirty_Established'] -->
<!--           totalTotal_overThirty_Established += row['Total_overThirty_Established'] -->
<!--         }) -->
<!--         return (totalNoShow_overThirty_Established + totalSameDayCanceled_overThirty_Established) / totalTotal_overThirty_Established || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_New` = colDef( -->
<!--       name = "All New", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_New = 0 -->
<!--         let totalSameDayCanceled_New = 0 -->
<!--         let totalTotal_New = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_New += row['NoShow_New'] -->
<!--           totalSameDayCanceled_New += row['SameDayCanceled_New'] -->
<!--           totalTotal_New += row['Total_New'] -->
<!--         }) -->
<!--         return (totalNoShow_New + totalSameDayCanceled_New) / totalTotal_New || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--    `noShow_rate_sameDay_New` = colDef( -->
<!--       name = "Scheduled Same-Day", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_sameDay_New = 0 -->
<!--         let totalSameDayCanceled_sameDay_New = 0 -->
<!--         let totalTotal_sameDay_New = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_sameDay_New += row['NoShow_sameDay_New'] -->
<!--           totalSameDayCanceled_sameDay_New += row['SameDayCanceled_sameDay_New'] -->
<!--           totalTotal_sameDay_New += row['Total_sameDay_New'] -->
<!--         }) -->
<!--         return (totalNoShow_sameDay_New + totalSameDayCanceled_sameDay_New) / totalTotal_sameDay_New || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--    `noShow_rate_belowFourteen_New` = colDef( -->
<!--       name = "Scheduled 1-14 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_belowFourteen_New = 0 -->
<!--         let totalSameDayCanceled_belowFourteen_New = 0 -->
<!--         let totalTotal_belowFourteen_New = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_belowFourteen_New += row['NoShow_belowFourteen_New'] -->
<!--           totalSameDayCanceled_belowFourteen_New += row['SameDayCanceled_belowFourteen_New'] -->
<!--           totalTotal_belowFourteen_New += row['Total_belowFourteen_New'] -->
<!--         }) -->
<!--         return (totalNoShow_belowFourteen_New + totalSameDayCanceled_belowFourteen_New) / totalTotal_belowFourteen_New || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_belowThirty_New` = colDef( -->
<!--       name = "Scheduled 15-30 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_belowThirty_New = 0 -->
<!--         let totalSameDayCanceled_belowThirty_New = 0 -->
<!--         let totalTotal_belowThirty_New = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_belowThirty_New += row['NoShow_belowThirty_New'] -->
<!--           totalSameDayCanceled_belowThirty_New += row['SameDayCanceled_belowThirty_New'] -->
<!--           totalTotal_belowThirty_New += row['Total_belowThirty_New'] -->
<!--         }) -->
<!--         return (totalNoShow_belowThirty_New + totalSameDayCanceled_belowThirty_New) / totalTotal_belowThirty_New || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_overThirty_New` = colDef( -->
<!--       name = "Scheduled >30 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_overThirty_New = 0 -->
<!--         let totalSameDayCanceled_overThirty_New = 0 -->
<!--         let totalTotal_overThirty_New = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_overThirty_New += row['NoShow_overThirty_New'] -->
<!--           totalSameDayCanceled_overThirty_New += row['SameDayCanceled_overThirty_New'] -->
<!--           totalTotal_overThirty_New += row['Total_overThirty_New'] -->
<!--         }) -->
<!--         return (totalNoShow_overThirty_New + totalSameDayCanceled_overThirty_New) / totalTotal_overThirty_New || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate` = colDef( -->
<!--       name = "All", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow = 0 -->
<!--         let totalSameDayCanceled = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow += row['NoShow'] -->
<!--           totalSameDayCanceled += row['SameDayCanceled'] -->
<!--           totalTotal += row['Total'] -->
<!--         }) -->
<!--         return (totalNoShow + totalSameDayCanceled) / totalTotal || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--    `noShow_rate_sameDay` = colDef( -->
<!--       name = "Scheduled Same-Day", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_sameDay = 0 -->
<!--         let totalSameDayCanceled_sameDay = 0 -->
<!--         let totalTotal_sameDay = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_sameDay += row['NoShow_sameDay'] -->
<!--           totalSameDayCanceled_sameDay += row['SameDayCanceled_sameDay'] -->
<!--           totalTotal_sameDay += row['Total_sameDay'] -->
<!--         }) -->
<!--         return (totalNoShow_sameDay + totalSameDayCanceled_sameDay) / totalTotal_sameDay || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--    `noShow_rate_belowFourteen` = colDef( -->
<!--       name = "Scheduled 1-14 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_belowFourteen = 0 -->
<!--         let totalSameDayCanceled_belowFourteen = 0 -->
<!--         let totalTotal_belowFourteen = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_belowFourteen += row['NoShow_belowFourteen'] -->
<!--           totalSameDayCanceled_belowFourteen += row['SameDayCanceled_belowFourteen'] -->
<!--           totalTotal_belowFourteen += row['Total_belowFourteen'] -->
<!--         }) -->
<!--         return (totalNoShow_belowFourteen + totalSameDayCanceled_belowFourteen) / totalTotal_belowFourteen || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_belowThirty` = colDef( -->
<!--       name = "Scheduled 15-30 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_belowThirty = 0 -->
<!--         let totalSameDayCanceled_belowThirty = 0 -->
<!--         let totalTotal_belowThirty = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_belowThirty += row['NoShow_belowThirty'] -->
<!--           totalSameDayCanceled_belowThirty += row['SameDayCanceled_belowThirty'] -->
<!--           totalTotal_belowThirty += row['Total_belowThirty'] -->
<!--         }) -->
<!--         return (totalNoShow_belowThirty + totalSameDayCanceled_belowThirty) / totalTotal_belowThirty || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     `noShow_rate_overThirty` = colDef( -->
<!--       name = "Scheduled >30 Days", -->
<!--       maxWidth = 90, -->
<!--       headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalNoShow_overThirty = 0 -->
<!--         let totalSameDayCanceled_overThirty = 0 -->
<!--         let totalTotal_overThirty = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalNoShow_overThirty += row['NoShow_overThirty'] -->
<!--           totalSameDayCanceled_overThirty += row['SameDayCanceled_overThirty'] -->
<!--           totalTotal_overThirty += row['Total_overThirty'] -->
<!--         }) -->
<!--         return (totalNoShow_overThirty + totalSameDayCanceled_overThirty) / totalTotal_overThirty || '-' -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 1), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived_Established = colDef(show =F), -->
<!--     Arrived_New = colDef(show =F), -->
<!--     Arrived_sameDay_Established = colDef(show =F), -->
<!--     Arrived_sameDay_New = colDef(show =F), -->
<!--     Arrived_belowFourteen_Established = colDef(show =F), -->
<!--     Arrived_belowFourteen_New = colDef(show =F), -->
<!--     Arrived_belowThirty_Established = colDef(show =F), -->
<!--     Arrived_belowThirty_New = colDef(show =F), -->
<!--     Arrived_overThirty_Established = colDef(show =F), -->
<!--     Arrived_overThirty_New = colDef(show =F), -->

<!--     NoShow_Established = colDef(show =F), -->
<!--     NoShow_New = colDef(show =F), -->
<!--     NoShow_sameDay_Established = colDef(show =F), -->
<!--     NoShow_sameDay_New = colDef(show =F), -->
<!--     NoShow_belowFourteen_Established = colDef(show =F), -->
<!--     NoShow_belowFourteen_New = colDef(show =F), -->
<!--     NoShow_belowThirty_Established = colDef(show =F), -->
<!--     NoShow_belowThirty_New = colDef(show =F), -->
<!--     NoShow_overThirty_Established = colDef(show =F), -->
<!--     NoShow_overThirty_New = colDef(show =F), -->

<!--     SameDayCanceled_Established = colDef(show =F), -->
<!--     SameDayCanceled_New = colDef(show =F), -->
<!--     SameDayCanceled_sameDay_Established = colDef(show =F), -->
<!--     SameDayCanceled_sameDay_New = colDef(show =F), -->
<!--     SameDayCanceled_belowFourteen_Established = colDef(show =F), -->
<!--     SameDayCanceled_belowFourteen_New = colDef(show =F), -->
<!--     SameDayCanceled_belowThirty_Established = colDef(show =F), -->
<!--     SameDayCanceled_belowThirty_New = colDef(show =F), -->
<!--     SameDayCanceled_overThirty_Established = colDef(show =F), -->
<!--     SameDayCanceled_overThirty_New = colDef(show =F), -->

<!--     Total_Established = colDef(show =F), -->
<!--     Total_New = colDef(show =F), -->
<!--     Total_sameDay_Established = colDef(show =F), -->
<!--     Total_sameDay_New = colDef(show =F), -->
<!--     Total_belowFourteen_Established = colDef(show =F), -->
<!--     Total_belowFourteen_New = colDef(show =F), -->
<!--     Total_belowThirty_Established = colDef(show =F), -->
<!--     Total_belowThirty_New = colDef(show =F), -->
<!--     Total_overThirty_Established = colDef(show =F), -->
<!--     Total_overThirty_New = colDef(show =F), -->

<!--     Total = colDef(show =F), -->
<!--     Total_sameDay = colDef(show =F), -->
<!--     Total_belowFourteen = colDef(show =F), -->
<!--     Total_belowThirty = colDef(show =F), -->
<!--     Total_overThirty = colDef(show =F), -->

<!--     Arrived_sameDay = colDef(show =F), -->
<!--     Arrived_belowFourteen = colDef(show =F), -->
<!--     Arrived_belowThirty = colDef(show =F), -->
<!--     Arrived_overThirty = colDef(show =F), -->

<!--     NoShow = colDef(show =F), -->
<!--     NoShow_sameDay = colDef(show =F), -->
<!--     NoShow_belowFourteen = colDef(show =F), -->
<!--     NoShow_belowThirty = colDef(show =F), -->
<!--     NoShow_overThirty = colDef(show =F), -->

<!--     SameDayCanceled = colDef(show =F), -->
<!--     SameDayCanceled_sameDay = colDef(show =F), -->
<!--     SameDayCanceled_belowFourteen = colDef(show =F), -->
<!--     SameDayCanceled_belowThirty = colDef(show =F), -->
<!--     SameDayCanceled_overThirty = colDef(show =F), -->
<!--     arrived_site = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->
<!-- <br/> -->

<!-- #### Trend -->
<!-- ```{r ONCOLOGY No Show Trend, echo = FALSE, warning = FALSE, message = FALSE} -->

<!-- no_show_trend_site_output <- no_show_trend_site_function("ONCOLOGY") -->

<!-- map(unique(no_show_trend_site_output$Campus.Specialty.Group), function(x){ -->
<!-- highchart() %>% -->
<!--   hc_yAxis_multiples( -->
<!--     # list(title = list(text = "Avg Volume per Day"), lineWidth = 3), -->
<!--     list(title = list(text = "No Show Rate"), lineWidth = 3,  -->
<!--          labels = list(format = '{value}%'), -->
<!--          plotLines = list(list(value = 20, color = "red", width = 2, -->
<!--                                dashStyle = "shortdash"))) -->
<!--            # showLastLabel = FALSE, opposite = TRUE) -->
<!--   ) %>% -->
<!--   hc_xAxis(title = list(text = ""), -->
<!--            categories = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$Appt.MonthYear, -->
<!--            type = "datetime", -->
<!--            labels = list(format = '{value:%Y-%m}') -->
<!--            # dateTimeLabelFormats = list(month = '%Y-%m') -->
<!--            ) %>% -->
<!--   # hc_add_series(name = "Total Visits", -->
<!--   #               data = (volume_trend_mshs %>% filter(Campus == x))$avg_vol_all, -->
<!--   #               type = 'column', -->
<!--   #               color='#212070', -->
<!--   #               dataLabels = list(enabled = TRUE, format='{point.y}')) %>% -->
<!--   hc_add_series(name   = "Established", -->
<!--                 data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_Established, -->
<!--                 type = 'line',  -->
<!--                 # color = '#a5a7a5' -->
<!--                 marker = list(enabled= TRUE), -->
<!--                 color='#212070', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#212070' -->
<!--                 ) %>% -->
<!--   hc_add_series(name   = "New", -->
<!--                 data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate_New, -->
<!--                 type = 'line',  -->
<!--                 # color = '#a5a7a5' -->
<!--                 marker = list(enabled= TRUE), -->
<!--                 color='#d80b8c', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#d80b8c' -->
<!--                 ) %>% -->
<!--   hc_add_series(name   = "All", -->
<!--                 data   = (no_show_trend_site_output %>% filter(Campus.Specialty.Group == x))$noShow_rate, -->
<!--                type = 'line',  -->
<!--                 # color = '#a5a7a5' -->
<!--                 marker = list(enabled= TRUE), -->
<!--                 color='#7f7f7f', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#7f7f7f' -->
<!--                 ) %>% -->
<!--   hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>% -->
<!--   hc_title(text = paste0("ONCOLOGY ", x, " - Avg No Show Rate"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>% -->
<!--   hc_subtitle(text = "Target:", -->
<!--               align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>% -->
<!--     hc_tooltip(shared = TRUE, borderColor = "black") -->
<!--   }) %>% -->
<!--   hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable() -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->
<!-- <br/> -->



